<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#1d4ed8" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="SUK Bangalore" />
<link rel="apple-touch-icon" href="icons/icon-192.png" />
<link rel="shortcut icon" href="icons/icon-96.png" type="image/png" />
<title>Jayguru ‚Äî Satsang Upayojana Kendra</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Lato:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Lato', sans-serif;
    min-height: 100vh;
    background: #e8f0fe;
    overflow-x: hidden;
  }

  .divine-bg {
    position: fixed; inset: 0; z-index: 0;
    background:
      radial-gradient(ellipse at 50% -5%,  rgba(99,145,255,0.45) 0%, transparent 50%),
      radial-gradient(ellipse at 0%   100%, rgba(29,78,216,0.2)  0%, transparent 50%),
      radial-gradient(ellipse at 100% 80%, rgba(79,120,255,0.15) 0%, transparent 50%),
      radial-gradient(ellipse at 50%  50%, rgba(255,220,120,0.04) 0%, transparent 60%),
      linear-gradient(180deg, #b8ccff 0%, #cfdeff 25%, #dce9ff 55%, #eef4ff 80%, #f5f8ff 100%);
  }
  /* Fine grain texture for depth */
  .divine-bg::after {
    content:""; position:absolute; inset:0;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E");
    opacity:0.4; pointer-events:none;
  }

  /* light rays from top */
  .rays { position:fixed; top:0; left:0; width:100vw; height:55vh; z-index:0; pointer-events:none; }
  .ray {
    position:absolute; top:0; width:2px;
    background:linear-gradient(to bottom,rgba(180,210,255,0.6),rgba(255,220,100,0.08),transparent);
    transform-origin:top center;
    animation:rayPulse ease-in-out infinite alternate;
    border-radius:1px;
  }
  @keyframes rayPulse {
    from { opacity:0.15; transform:scaleX(1) rotate(var(--r)); }
    to   { opacity:0.55; transform:scaleX(3) rotate(var(--r)); }
  }

  /* Dual rotating mandalas */
  .mandala {
    position:fixed; top:50%; left:50%;
    transform:translate(-50%,-50%);
    width:780px; height:780px;
    opacity:0.07; z-index:0;
    animation:rotateMandala 90s linear infinite;
    pointer-events:none;
  }
  .mandala2 {
    position:fixed; top:50%; left:50%;
    transform:translate(-50%,-50%);
    width:500px; height:500px;
    opacity:0.05; z-index:0;
    animation:rotateMandala 55s linear infinite reverse;
    pointer-events:none;
  }
  @keyframes fadeSlideIn {
  from { opacity:0; transform:translateY(16px) scale(0.97); }
  to   { opacity:1; transform:translateY(0) scale(1); }
}
  @keyframes dotPulse {
    0%,80%,100% { transform:scale(0.6); opacity:0.4; }
    40%          { transform:scale(1.1); opacity:1; }
  }
  @keyframes chevronBounce {
    0%,100% { transform:translateY(-50%); }
    50%      { transform:translateY(-35%); }
  }
  @keyframes rotateMandala {
    from { transform:translate(-50%,-50%) rotate(0deg); }
    to   { transform:translate(-50%,-50%) rotate(360deg); }
  }

  /* particles */
  .particles { position:fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden; }
  .particle {
    position:absolute; border-radius:50%;
    animation:floatUp linear infinite;
  }
  @keyframes floatUp {
    0%   { transform:translateY(100vh) scale(0); opacity:0; }
    8%   { opacity:1; }
    92%  { opacity:0.4; }
    100% { transform:translateY(-8vh) scale(1.2); opacity:0; }
  }

  /* ‚ïê‚ïê SPLASH ‚ïê‚ïê */
  #splash {
    position:fixed; inset:0; z-index:9999;
    background:
      radial-gradient(ellipse at 50% 0%,   #1a3a9e 0%, transparent 65%),
      radial-gradient(ellipse at 0%   100%, #0d1f5c 0%, transparent 60%),
      radial-gradient(ellipse at 100% 100%, #0a1845 0%, transparent 60%),
      linear-gradient(160deg, #050d2e 0%, #0c1d5e 40%, #0f2470 100%);
    display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    transition:opacity 1.2s ease, visibility 1.2s ease;
    overflow:hidden;
  }
  #splash.hidden { opacity:0; visibility:hidden; }

  /* Gold mandala rings */
  .splash-ring {
    position:absolute; border-radius:50%; pointer-events:none;
    border:1px solid rgba(255,215,100,0.12);
    animation:splashRing 5s ease-out infinite;
  }
  @keyframes splashRing {
    0%   { transform:scale(0.1); opacity:0.9; }
    100% { transform:scale(5);   opacity:0; }
  }

  /* Gold shimmer beams */
  .splash-beam {
    position:absolute; top:0; width:1px; height:60%;
    background:linear-gradient(to bottom, rgba(255,210,80,0.35), transparent);
    transform-origin:top center;
    animation:beamPulse 4s ease-in-out infinite alternate;
  }
  @keyframes beamPulse {
    from { opacity:0.1; transform:scaleX(1) rotate(var(--r)); }
    to   { opacity:0.6; transform:scaleX(4) rotate(var(--r)); }
  }

  /* Floating gold petals */
  .splash-petal {
    position:absolute; font-size:14px;
    animation:petalFloat linear infinite;
    opacity:0;
  }
  @keyframes petalFloat {
    0%   { transform:translateY(110vh) rotate(0deg)   scale(0.5); opacity:0; }
    10%  { opacity:0.8; }
    90%  { opacity:0.4; }
    100% { transform:translateY(-10vh)  rotate(720deg) scale(1.2); opacity:0; }
  }

  /* Central lotus glow */
  .splash-lotus {
    position:relative; z-index:2;
    font-size:72px; margin-bottom:0px;
    filter:drop-shadow(0 0 30px rgba(255,200,50,0.8))
           drop-shadow(0 0 80px rgba(255,160,0,0.4));
    animation:lotusFloat 3s ease-in-out infinite alternate,
              lotusGlow  2s ease-in-out infinite alternate;
  }
  @keyframes lotusFloat {
    from { transform:translateY(0) scale(1); }
    to   { transform:translateY(-18px) scale(1.05); }
  }
  @keyframes lotusGlow {
    from { filter:drop-shadow(0 0 20px rgba(255,200,50,0.6)) drop-shadow(0 0 60px rgba(255,160,0,0.3)); }
    to   { filter:drop-shadow(0 0 50px rgba(255,220,80,1.0)) drop-shadow(0 0 120px rgba(255,180,0,0.6)); }
  }

  /* Jayguru title */
  .splash-jayguru {
    font-family:'Cinzel',serif; font-size:56px; font-weight:900;
    letter-spacing:8px; position:relative; z-index:2; margin-top:18px;
    background:linear-gradient(180deg, #ffe47a 0%, #ffc020 40%, #ffaa00 70%, #e87c00 100%);
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    background-clip:text;
    animation:titleReveal 1s ease 0.3s both, titleShimmer 3s ease-in-out 1.5s infinite alternate;
  }
  @keyframes titleReveal {
    from { opacity:0; transform:translateY(30px) scale(0.9); letter-spacing:20px; }
    to   { opacity:1; transform:translateY(0)    scale(1);   letter-spacing:8px; }
  }
  @keyframes titleShimmer {
    from { filter:brightness(1); }
    to   { filter:brightness(1.4) drop-shadow(0 0 20px rgba(255,200,50,0.5)); }
  }

  /* Gold decorative line */
  .splash-ornament {
    position:relative; z-index:2;
    display:flex; align-items:center; gap:12px;
    margin:12px 0; animation:fadeInUp 1s ease 0.8s both;
  }
  .splash-ornament-line {
    width:60px; height:1px;
    background:linear-gradient(90deg, transparent, rgba(255,200,80,0.6), transparent);
  }
  .splash-ornament span { color:rgba(255,200,80,0.8); font-size:14px; }

  /* Subtitle */
  .splash-sub {
    color:rgba(200,220,255,0.7); font-size:12px; letter-spacing:5px;
    text-transform:uppercase; position:relative; z-index:2;
    animation:fadeInUp 1s ease 1s both;
    font-family:'Lato',sans-serif;
  }

  /* SUK name */
  .splash-suk {
    color:rgba(255,200,80,0.55); font-family:'Cinzel',serif;
    font-size:11px; letter-spacing:4px; margin-top:6px;
    position:relative; z-index:2;
    animation:fadeInUp 1s ease 1.2s both;
    text-transform:uppercase;
  }

  @keyframes fadeInUp {
    from { opacity:0; transform:translateY(20px); }
    to   { opacity:1; transform:translateY(0); }
  }


  /* ‚îÄ‚îÄ Skeleton / shimmer loader ‚îÄ‚îÄ */
  .skeleton {
    background: linear-gradient(90deg,
      rgba(219,234,254,0.6) 25%,
      rgba(191,219,254,0.9) 50%,
      rgba(219,234,254,0.6) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.6s ease-in-out infinite;
    border-radius: 8px;
  }
  @keyframes shimmer {
    0%   { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }
  .skeleton-card {
    background: rgba(255,255,255,0.75);
    border-radius: 14px;
    padding: 18px;
    border: 1px solid rgba(59,130,246,0.1);
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  /* Bottom loading bar */
  .splash-bar-wrap {
    position:absolute; bottom:0; left:0; right:0; height:3px;
    background:rgba(255,255,255,0.05); z-index:2;
  }
  .splash-bar {
    height:100%; width:0%;
    background:linear-gradient(90deg, #ffc020, #ffe47a, #ffc020);
    animation:loadBar 2.6s ease forwards;
  }
  @keyframes loadBar {
    0%   { width:0%; }
    30%  { width:40%; }
    70%  { width:75%; }
    100% { width:100%; }
  }

  /* ‚ïê‚ïê MODAL ‚ïê‚ïê */
  .modal-overlay {
    position:fixed; inset:0; z-index:1000;
    background:rgba(8,25,90,0.55);
    backdrop-filter:blur(8px);
    display:flex; align-items:center; justify-content:center;
    padding:20px; animation:fadeIn 0.3s ease;
  }
  .modal-box {
    background:#fff; border-radius:26px; padding:38px 30px;
    max-width:380px; width:100%; text-align:center;
    box-shadow:0 24px 70px rgba(15,40,160,0.28);
    animation:popIn 0.38s cubic-bezier(0.175,0.885,0.32,1.275);
    border-top:5px solid #1d4ed8; position:relative; overflow:hidden;
  }
  .modal-box::before {
    content:''; position:absolute; top:0; left:0; right:0; height:70px;
    background:linear-gradient(180deg,rgba(219,234,254,0.6),transparent);
    pointer-events:none;
  }
  @keyframes popIn {
    from { opacity:0; transform:scale(0.78) translateY(24px); }
    to   { opacity:1; transform:scale(1) translateY(0); }
  }
  .modal-icon { font-size:52px; margin-bottom:14px; animation:floatEmoji 2s ease-in-out infinite alternate; }
  .modal-title { font-family:'Cinzel',serif; font-size:21px; font-weight:800; color:#1e3a8a; margin-bottom:14px; }
  .modal-msg   { font-size:14px; line-height:1.85; color:#374151; }
  .modal-jayguru {
    font-family:'Cinzel',serif; font-size:19px; font-weight:700;
    color:#1d4ed8; margin-top:16px; letter-spacing:2px;
  }
  .modal-close-btn {
    margin-top:22px; width:100%; padding:14px;
    border:none; border-radius:13px;
    background:linear-gradient(135deg,#1740c8,#3b82f6);
    color:#fff; font-weight:800; font-size:15px;
    cursor:pointer; font-family:'Cinzel',serif; letter-spacing:1px;
    box-shadow:0 5px 18px rgba(29,78,216,0.35); transition:all 0.2s;
  }
  .modal-close-btn:hover { transform:translateY(-2px); box-shadow:0 8px 24px rgba(29,78,216,0.45); }

  /* ‚ïê‚ïê CONTENT ‚ïê‚ïê */
  .content {
    position:relative; z-index:1;
    max-width:640px; margin:0 auto;
    padding:0 16px 80px;
  }

  input,select,button { font-family:'Lato',sans-serif; }
  input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(0.25) sepia(1) saturate(3) hue-rotate(195deg);
    cursor: pointer;
    width: 22px;
    height: 22px;
    opacity: 0.7;
    padding: 2px;
  }
  input[type="date"]::-webkit-calendar-picker-indicator:hover {
    opacity: 1;
  }
  input[type="date"] {
    color-scheme: light;
  }

  .blue-line {
    height:1px;
    background:linear-gradient(90deg,
      transparent,
      rgba(255,200,60,0.3) 20%,
      rgba(59,130,246,0.5) 50%,
      rgba(255,200,60,0.3) 80%,
      transparent);
    margin:6px 0;
  }

  /* ‚ïê‚ïê CARD ‚Äî divine glass with golden breath ‚ïê‚ïê */
  .card {
    background: rgba(255,255,255,0.92);
    border: 1px solid rgba(59,130,246,0.18);
    border-radius: 26px;
    padding: 28px 24px;
    backdrop-filter: blur(20px);
    box-shadow:
      0 2px 0 rgba(255,210,80,0.35),
      0 10px 40px rgba(29,78,216,0.12),
      0 2px 0 rgba(255,255,255,0.9) inset,
      0 -1px 0 rgba(59,130,246,0.08) inset;
    position: relative;
    overflow: hidden;
  }
  /* Warm golden shimmer sweep */
  .card::before {
    content:''; position:absolute; top:0; left:-100%; width:60%; height:100%;
    background: linear-gradient(105deg,
      transparent 30%,
      rgba(255,220,100,0.06) 50%,
      transparent 70%);
    animation: cardSweep 8s ease-in-out infinite;
    pointer-events:none;
  }
  @keyframes cardSweep {
    0%   { left:-100%; }
    50%  { left:160%; }
    100% { left:160%; }
  }
  /* Subtle blue-gold inner glow */
  .card::after {
    content:''; position:absolute; inset:0;
    border-radius:26px; pointer-events:none;
    background: linear-gradient(160deg,
      rgba(255,215,80,0.04) 0%,
      rgba(99,145,255,0.07) 40%,
      transparent 70%,
      rgba(99,145,255,0.04) 100%);
    animation: cardSheen 7s ease-in-out infinite alternate;
  }
  @keyframes cardSheen {
    from { opacity:0.4; }
    to   { opacity:1; }
  }

  .tab-btn {
    flex:1; border:none; cursor:pointer;
    padding:10px 6px; border-radius:10px;
    font-size:13px; font-weight:600;
    transition:all 0.2s; letter-spacing:0.3px;
  }
  .tab-btn.active {
    background:linear-gradient(135deg,#0e2266,#1d4ed8,#3b82f6);
    color:#fff;
    box-shadow:0 3px 14px rgba(29,78,216,0.35), 0 1px 0 rgba(255,210,80,0.25) inset;
  }
  .tab-btn.inactive { background:transparent; color:rgba(30,64,175,0.55); }
  .tab-btn.inactive:hover { color:#1d4ed8; background:rgba(59,130,246,0.07); }

  .divine-input {
    width:100%; padding:12px 14px; border-radius:12px;
    border:1px solid rgba(59,130,246,0.25);
    background: linear-gradient(135deg, rgba(240,246,255,0.95), rgba(248,252,255,0.9));
    color:#1e3a8a; font-size:14px; outline:none; transition:all 0.25s;
    box-shadow: inset 0 1px 3px rgba(29,78,216,0.06);
  }
  .divine-input:focus {
    border-color: rgba(59,130,246,0.6);
    background: #fff;
    box-shadow: 0 0 0 3px rgba(59,130,246,0.1), 0 0 0 1px rgba(255,200,60,0.15), inset 0 1px 2px rgba(29,78,216,0.04);
  }
  .divine-input::placeholder { color:rgba(96,130,200,0.4); }

  .divine-label {
    display:block; font-size:11px; font-weight:700;
    color:rgba(29,78,216,0.65); margin-bottom:7px;
    text-transform:uppercase; letter-spacing:1.5px;
  }
  .divine-label::before {
    content:'‚ú¶ ';
    color:rgba(200,160,30,0.55);
    font-size:9px;
  }

  .slot-btn {
    flex:1; border-radius:16px; cursor:pointer;
    padding:22px 10px; border:2px solid;
    transition:all 0.2s; position:relative; text-align:center;
  }
  .slot-btn:not(:disabled):hover { transform:translateY(-2px); box-shadow:0 6px 18px rgba(29,78,216,0.15); }
  .slot-btn:disabled { cursor:not-allowed; }

  /* glowing submit button */
  .submit-btn {
    width:100%; padding:15px; border:none; border-radius:13px;
    background:linear-gradient(135deg,#0e2266 0%,#1d4ed8 50%,#3b82f6 100%);
    background-size:200% auto;
    color:#fff; font-weight:900; font-size:16px; cursor:pointer;
    letter-spacing:0.5px; font-family:'Cinzel',serif;
    transition:all 0.3s;
    box-shadow:0 5px 22px rgba(29,78,216,0.4);
    animation:btnPulse 3s ease-in-out infinite alternate;
  }
  @keyframes btnPulse {
    from { box-shadow:0 4px 18px rgba(29,78,216,0.35); }
    to   { box-shadow:0 6px 30px rgba(29,78,216,0.65), 0 0 50px rgba(99,145,255,0.15); }
  }
  .submit-btn:hover:not(:disabled) { background-position:right center; transform:translateY(-2px); }
  .submit-btn:disabled { opacity:0.6; cursor:wait; animation:none; }

  /* shimmer Jayguru title */
  .jayguru-title {
    font-family:'Cinzel',serif; font-size:46px; font-weight:900;
    letter-spacing:6px; display:inline-block;
    background:linear-gradient(160deg,
      #0e2266 0%, #1d4ed8 18%,
      #60a5fa 32%, #ffffff 42%, #ffe47a 50%,
      #ffffff 58%, #60a5fa 68%,
      #1d4ed8 82%, #0e2266 100%);
    background-size:300% auto;
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    background-clip:text;
    filter:drop-shadow(0 0 20px rgba(99,145,255,0.25));
    animation:shimmerTitle 5s linear infinite;
  }
  @keyframes shimmerTitle {
    from { background-position:300% center; }
    to   { background-position:-300% center; }
  }

  /* glowing halo behind header */
  .header-halo {
    position:absolute; top:50%; left:50%;
    transform:translate(-50%,-50%);
    width:300px; height:140px; border-radius:50%;
    background:radial-gradient(ellipse,rgba(99,145,255,0.22) 0%,transparent 70%);
    animation:haloPulse 3.5s ease-in-out infinite alternate;
    pointer-events:none;
  }
  @keyframes haloPulse {
    from { opacity:0.5; transform:translate(-50%,-50%) scale(0.88); }
    to   { opacity:1;   transform:translate(-50%,-50%) scale(1.18); }
  }

  @keyframes shake {
    0%,100%{ transform:translateX(0); }
    20%{ transform:translateX(-8px); }
    40%{ transform:translateX(8px); }
    60%{ transform:translateX(-4px); }
    80%{ transform:translateX(4px); }
  }
  .shake { animation:shake 0.4s ease; }

  @keyframes fadeIn {
    from { opacity:0; transform:translateY(-6px); }
    to   { opacity:1; transform:translateY(0); }
  }
  .fade-in { animation:fadeIn 0.3s ease; }

  ::-webkit-scrollbar { width:5px; }
  ::-webkit-scrollbar-track { background:#eff6ff; }
  ::-webkit-scrollbar-thumb { background:rgba(59,130,246,0.35); border-radius:3px; }
</style>
</head>
<body>

<!-- ‚îÄ‚îÄ SPLASH SCREEN ‚îÄ‚îÄ -->
<div id="splash">
  <!-- Gold beams of light -->
  <div class="splash-beam" style="left:30%;--r:-35deg;animation-delay:0s;animation-duration:3.5s"></div>
  <div class="splash-beam" style="left:40%;--r:-18deg;animation-delay:0.4s;animation-duration:4s"></div>
  <div class="splash-beam" style="left:50%;--r:0deg;animation-delay:0s;animation-duration:3s"></div>
  <div class="splash-beam" style="left:60%;--r:18deg;animation-delay:0.6s;animation-duration:4.5s"></div>
  <div class="splash-beam" style="left:70%;--r:35deg;animation-delay:0.2s;animation-duration:3.8s"></div>

  <!-- Expanding sacred rings -->
  <div class="splash-ring" style="width:180px;height:180px;animation-delay:0s;animation-duration:4s;border-color:rgba(255,200,80,0.2)"></div>
  <div class="splash-ring" style="width:180px;height:180px;animation-delay:1.5s;animation-duration:4s;border-color:rgba(255,200,80,0.15)"></div>
  <div class="splash-ring" style="width:180px;height:180px;animation-delay:3s;animation-duration:4s;border-color:rgba(255,200,80,0.1)"></div>

  <!-- Floating lotus petals -->
  <div class="splash-petal" style="left:5%;animation-duration:6s;animation-delay:0s;filter:saturate(0) brightness(2.5) drop-shadow(0 0 6px rgba(255,255,255,0.9))">ü™∑</div>
  <div class="splash-petal" style="left:14%;animation-duration:8s;animation-delay:0.8s;filter:drop-shadow(0 0 8px rgba(255,180,210,0.8))">ü™∑</div>
  <div class="splash-petal" style="left:25%;animation-duration:7s;animation-delay:1.5s;filter:saturate(0) brightness(2.5) drop-shadow(0 0 6px rgba(255,255,255,0.9))">ü™∑</div>
  <div class="splash-petal" style="left:36%;animation-duration:5.5s;animation-delay:0.3s;filter:drop-shadow(0 0 8px rgba(255,180,210,0.8))">ü™∑</div>
  <div class="splash-petal" style="left:47%;animation-duration:9s;animation-delay:2s;filter:saturate(0) brightness(2.5) drop-shadow(0 0 6px rgba(255,255,255,0.9))">ü™∑</div>
  <div class="splash-petal" style="left:58%;animation-duration:6.5s;animation-delay:0.6s;filter:drop-shadow(0 0 8px rgba(255,180,210,0.8))">ü™∑</div>
  <div class="splash-petal" style="left:69%;animation-duration:7.5s;animation-delay:1.2s;filter:saturate(0) brightness(2.5) drop-shadow(0 0 6px rgba(255,255,255,0.9))">ü™∑</div>
  <div class="splash-petal" style="left:80%;animation-duration:6s;animation-delay:1.8s;filter:drop-shadow(0 0 8px rgba(255,180,210,0.8))">ü™∑</div>
  <div class="splash-petal" style="left:91%;animation-duration:8.5s;animation-delay:0.4s;filter:saturate(0) brightness(2.5) drop-shadow(0 0 6px rgba(255,255,255,0.9))">ü™∑</div>

  <!-- Central content -->
  <div class="splash-lotus">ü™∑</div>

  <div class="splash-jayguru">Jayguru</div>

  <div class="splash-ornament">
    <div class="splash-ornament-line"></div>
    <span>‚ú¶ üôè ‚ú¶</span>
    <div class="splash-ornament-line"></div>
  </div>

  <div class="splash-suk" id="splashSukName">Satsang Upayojana Kendra</div>

  <!-- Gold loading bar at bottom -->
  <div class="splash-bar-wrap">
    <div class="splash-bar"></div>
  </div>
</div>

<!-- Background -->
<div class="divine-bg"></div>

<!-- Light rays -->
<div class="rays" id="rays"></div>

<!-- Particles -->
<div class="particles" id="particles"></div>

<!-- Outer mandala -->
<svg class="mandala" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg">
  <g fill="none" stroke="#1d4ed8" stroke-width="0.7" transform="translate(250,250)">
    <circle r="240"/><circle r="210"/><circle r="180"/><circle r="150"/><circle r="110"/><circle r="70"/><circle r="36"/>
    <ellipse rx="28" ry="95" transform="rotate(0)"/>
    <ellipse rx="28" ry="95" transform="rotate(30)"/>
    <ellipse rx="28" ry="95" transform="rotate(60)"/>
    <ellipse rx="28" ry="95" transform="rotate(90)"/>
    <ellipse rx="28" ry="95" transform="rotate(120)"/>
    <ellipse rx="28" ry="95" transform="rotate(150)"/>
    <ellipse rx="16" ry="55" transform="rotate(15)"/>
    <ellipse rx="16" ry="55" transform="rotate(45)"/>
    <ellipse rx="16" ry="55" transform="rotate(75)"/>
    <ellipse rx="16" ry="55" transform="rotate(105)"/>
    <ellipse rx="16" ry="55" transform="rotate(135)"/>
    <ellipse rx="16" ry="55" transform="rotate(165)"/>
    <line x1="0" y1="-240" x2="0" y2="240"/>
    <line x1="0" y1="-240" x2="0" y2="240" transform="rotate(30)"/>
    <line x1="0" y1="-240" x2="0" y2="240" transform="rotate(60)"/>
    <line x1="0" y1="-240" x2="0" y2="240" transform="rotate(90)"/>
    <line x1="0" y1="-240" x2="0" y2="240" transform="rotate(120)"/>
    <line x1="0" y1="-240" x2="0" y2="240" transform="rotate(150)"/>
    <polygon points="0,-190 24,-166 0,-142 -24,-166" transform="rotate(0)"/>
    <polygon points="0,-190 24,-166 0,-142 -24,-166" transform="rotate(30)"/>
    <polygon points="0,-190 24,-166 0,-142 -24,-166" transform="rotate(60)"/>
    <polygon points="0,-190 24,-166 0,-142 -24,-166" transform="rotate(90)"/>
    <polygon points="0,-190 24,-166 0,-142 -24,-166" transform="rotate(120)"/>
    <polygon points="0,-190 24,-166 0,-142 -24,-166" transform="rotate(150)"/>
    <polygon points="0,-190 24,-166 0,-142 -24,-166" transform="rotate(180)"/>
    <polygon points="0,-190 24,-166 0,-142 -24,-166" transform="rotate(210)"/>
    <polygon points="0,-190 24,-166 0,-142 -24,-166" transform="rotate(240)"/>
    <polygon points="0,-190 24,-166 0,-142 -24,-166" transform="rotate(270)"/>
    <polygon points="0,-190 24,-166 0,-142 -24,-166" transform="rotate(300)"/>
    <polygon points="0,-190 24,-166 0,-142 -24,-166" transform="rotate(330)"/>
  </g>
</svg>

<!-- Inner counter-rotating mandala -->
<svg class="mandala2" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg">
  <g fill="none" stroke="#3b82f6" stroke-width="0.8" transform="translate(250,250)">
    <circle r="220"/><circle r="170"/><circle r="120"/><circle r="70"/><circle r="30"/>
    <ellipse rx="22" ry="80" transform="rotate(0)"/>
    <ellipse rx="22" ry="80" transform="rotate(45)"/>
    <ellipse rx="22" ry="80" transform="rotate(90)"/>
    <ellipse rx="22" ry="80" transform="rotate(135)"/>
    <line x1="0" y1="-220" x2="0" y2="220" transform="rotate(22.5)"/>
    <line x1="0" y1="-220" x2="0" y2="220" transform="rotate(67.5)"/>
    <line x1="0" y1="-220" x2="0" y2="220" transform="rotate(112.5)"/>
    <line x1="0" y1="-220" x2="0" y2="220" transform="rotate(157.5)"/>
  </g>
</svg>

<div id="root"></div>

<script>
  // Splash ‚Äî 2.8s then fade
  setTimeout(() => document.getElementById('splash').classList.add('hidden'), 2800);

  // ‚îÄ‚îÄ Light rays ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const raysEl = document.getElementById('rays');
  const rayCount = 18;
  for (let i = 0; i < rayCount; i++) {
    const r = document.createElement('div');
    r.className = 'ray';
    const pct = 10 + (i / (rayCount - 1)) * 80;
    r.style.left = pct + 'vw';
    r.style.height = (40 + Math.random() * 25) + 'vh';
    r.style.width  = (0.8 + Math.random() * 2.5) + 'px';
    r.style.setProperty('--r', (Math.random() * 10 - 5) + 'deg');
    r.style.animationDuration  = (2.5 + Math.random() * 4) + 's';
    r.style.animationDelay     = (Math.random() * 4) + 's';
    raysEl.appendChild(r);
  }

  // ‚îÄ‚îÄ Divine floating particles ‚Äî gold, blue, white, lotus ‚îÄ‚îÄ
  const pc = document.getElementById('particles');
  const colors = [
    'rgba(255,200,50,0.7)',   // bright gold
    'rgba(212,175,55,0.6)',   // deep gold
    'rgba(59,130,246,0.5)',   // royal blue
    'rgba(99,165,255,0.4)',   // sky blue
    'rgba(255,255,255,0.75)', // white sparkle
    'rgba(147,197,253,0.5)',  // pale blue
    'rgba(255,230,130,0.55)', // soft gold
  ];
  const emojis = ['ü™∑','ü™∑','ü™∑','ü™∑','ü™∑','ü™∑','ü™∑'];
  for (let i = 0; i < 55; i++) {
    const p = document.createElement('div');
    p.style.position = 'absolute';
    p.style.left = Math.random() * 100 + 'vw';
    p.style.animation = `floatUp ${14 + Math.random() * 22}s linear ${Math.random() * 20}s infinite`;
    if (i % 7 === 0) {
      // Lotus / sparkle emoji particle
      p.style.fontSize = (10 + Math.random() * 10) + 'px';
      p.innerText = emojis[Math.floor(Math.random() * emojis.length)];
      p.style.opacity = '0';
      // Alternate white lotus / pink lotus
      p.style.filter = (Math.floor(Math.random()*2)===0)
        ? 'saturate(0) brightness(2.5) drop-shadow(0 0 6px rgba(255,255,255,0.8))'
        : 'drop-shadow(0 0 8px rgba(255,180,210,0.8))';
    } else {
      p.className = 'particle';
      const sz = Math.random() * 4 + 1;
      p.style.width  = sz + 'px';
      p.style.height = sz + 'px';
      p.style.background = colors[Math.floor(Math.random() * colors.length)];
      p.style.borderRadius = i % 3 === 0 ? '2px' : '50%';
      if (i % 3 === 0) p.style.transform = 'rotate(45deg)';
    }
    pc.appendChild(p);
  }
</script>

<script type="text/babel">

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
//  APP CONFIGURATION ‚Äî CHANGE THIS WHEN MOVING TO A NEW URL
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
const APP_CONFIG = {

  // Your GitHub Pages folder name in the URL.
  // URL:  https://bangaloresuk.github.io/bsuk/  ‚Üí basePath: "/bsuk/"
  // URL:  https://yourname.github.io/myapp/     ‚Üí basePath: "/myapp/"
  // URL:  https://yoursite.com/                 ‚Üí basePath: "/"
  basePath: "/bsuk/",

};
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ============================================================
//  MULTI-SUK CONFIGURATION
//  Add a new block here for every new SUK that joins.
//  Each SUK needs its own: scriptUrl, apiKey, photoFolderId
// ============================================================
const SUK_CONFIG = {
  "bannerghatta": {
    key:          "bannerghatta",
    name:         "Bannerghatta Satsang Upayojana Kendra",
    shortName:    "Bannerghatta SUK",   // ‚Üê EDIT THIS to change display name everywhere
    location:     "Bangalore South",
    emoji:        "ü™∑",
    themeColor:   "#1d4ed8",
    scriptUrl:    "https://script.google.com/macros/s/AKfycbxiVssfXF3UR24GHO5EhmMPdJbZ45fJ9xM3HrVrAe1usH7tzfaX_DVu30aUNEODwcfYVA/exec",
    apiKey:       "1e267c88ee92686c6e78da0a1ba9eb26023410dc6e171241",
    configured:   true,
    features:     {},  // Full feature set ‚Äî everything on
  },
  "other": {
    key:          "other",
    name:         "other Satsang Kendra",
    shortName:    "other SUK",     // ‚Üê EDIT THIS to change display name everywhere
    // location:     "Bangalore East",
    emoji:        "üå∏",
    themeColor:   "#7c3aed",
    scriptUrl:    "https://script.google.com/macros/s/AKfycbz-ptMI2wXf8sp_2YCYGIzrbUXstBr5dO10jS4Xd5odfQXQe7Kg5S8rrIWGClpoyQWcIA/exec",
    apiKey:       "1e267c88ee92686c6e78da0a1ba9eb26023410dc6e171241",
    configured:   true,  // ‚Üê set true once script is deployed
    // Only prayer ‚Äî no satsang, no gallery, no messages
    features: {
      satsangBooking:  false,
      photoGallery:    false,
      messages:        false,
    },
  },
  // "jayanagar": {
  //   key:          "jayanagar",
  //   name:         "Jayanagar Satsang Upayojana Kendra",
  //   shortName:    "Jayanagar SUK",      // ‚Üê EDIT THIS to change display name everywhere
  //   location:     "Bangalore Central",
  //   emoji:        "üå∫",
  //   themeColor:   "#065f46",
  //   scriptUrl:    "YOUR_JAYANAGAR_SCRIPT_URL_HERE",
  //   apiKey:       "YOUR_JAYANAGAR_API_KEY_HERE",
  //   configured:   false,  // ‚Üê set true once script is deployed
  //   // Prayer + satsang + messages ‚Äî no cancel, no calendar, no gallery
  //   features: {
  //     cancelBooking:   false,
  //     allBookings:     false,
  //     photoGallery:    false,
  //   },
  // },
};

// ‚îÄ‚îÄ Feature defaults ‚Äî every SUK starts with ALL features on ‚îÄ‚îÄ
const DEFAULT_FEATURES = {
  prayerBooking:   true,   // Book tab ‚Äî morning/evening prayer slot
  satsangBooking:  true,   // Book tab ‚Äî satsang booking
  cancelBooking:   true,   // Cancel section inside Book tab
  retrieveBooking: true,   // "Retrieve Booking" sub-tab in Manage
  allBookings:     true,   // "All Bookings" calendar sub-tab
  prayerTimes:     true,   // "Prayer Timings" sub-tab
  messages:        true,   // "Messages" sub-tab (invitations)
  photoGallery:    true,   // "Photo Gallery" sub-tab
};

// ‚îÄ‚îÄ Helper: returns shortName for display, full name as fallback ‚îÄ‚îÄ
function sukLabel(suk) {
  if (!suk) return "";
  return suk.shortName || suk.name;
}

// ‚îÄ‚îÄ Active SUK ‚Äî set by welcome screen at runtime ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Do NOT change these manually; they are set when user picks a SUK
let SCRIPT_URL = "";
let API_KEY    = "";
let ACTIVE_SUK = null;

// ‚îÄ‚îÄ Fixed prayer times ‚Äî Bangalore Urban (satsang.org.in) ‚îÄ‚îÄ‚îÄ
const PRAYER_TIMES = {
  1:  { Morning:"06:44", Evening:"18:10" },
  2:  { Morning:"06:40", Evening:"18:23" },
  3:  { Morning:"06:24", Evening:"18:28" },
  4:  { Morning:"06:04", Evening:"18:31" },
  5:  { Morning:"05:52", Evening:"18:37" },
  6:  { Morning:"05:51", Evening:"18:46" },
  7:  { Morning:"05:59", Evening:"18:48" },
  8:  { Morning:"06:05", Evening:"18:38" },
  9:  { Morning:"06:06", Evening:"18:19" },
  10: { Morning:"06:09", Evening:"17:58" },
  11: { Morning:"06:18", Evening:"17:48" },
  12: { Morning:"06:34", Evening:"17:54" },
};
const MONTH_NAMES = ["","January","February","March","April","May","June",
  "July","August","September","October","November","December"];

function getPrayerTimes(dateStr) {
  if (!dateStr) return null;
  return PRAYER_TIMES[parseInt(dateStr.split("-")[1], 10)];
}
function getMonthName(dateStr) {
  if (!dateStr) return "";
  return MONTH_NAMES[parseInt(dateStr.split("-")[1], 10)];
}
function formatDate(dateStr) {
  if (!dateStr) return "";
  return new Date(dateStr + "T00:00:00").toLocaleDateString("en-IN", {
    day:"numeric", month:"long", year:"numeric"
  });
}
function formatDateWithDay(dateStr) {
  if (!dateStr) return "";
  const d = new Date(dateStr + "T00:00:00");
  const day = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][d.getDay()];
  return day + ", " + d.toLocaleDateString("en-IN", { day:"numeric", month:"long", year:"numeric" });
}
function cleanTime(val) {
  if (!val) return "";
  // Handle Google Sheets time bug ‚Äî "Sat Dec 30 1899 18:23:00 GMT+..." ‚Üí "18:23"
  const s = String(val).trim();
  if (!s || s === "undefined") return "";
  // Already clean like "06:40" or "6:40 PM"
  if (/^\d{1,2}:\d{2}$/.test(s)) return s;
  if (/^\d{1,2}:\d{2}\s?(AM|PM)$/i.test(s)) return s;
  // Google Sheets 1899 date bug ‚Äî extract HH:MM from the time portion
  const m1899 = s.match(/1899.*?(\d{1,2}):(\d{2}):\d{2}/i);
  if (m1899) return String(m1899[1]).padStart(2,"0")+":"+m1899[2];
  // Try to parse as date and extract time
  try {
    const d = new Date(s);
    if (!isNaN(d)) {
      return String(d.getHours()).padStart(2,"0") + ":" + String(d.getMinutes()).padStart(2,"0");
    }
  } catch(e) {}
  // Fallback: grab first HH:MM pattern
  const m = s.match(/(\d{1,2}:\d{2})/);
  return m ? m[1] : s;
}

function getDayName(dateStr) {
  const n = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
  return n[new Date(dateStr + "T00:00:00").getDay()];
}

function getTodayStr() {
  const t = new Date();
  const y = t.getFullYear();
  const m = String(t.getMonth()+1).padStart(2,"0");
  const d = String(t.getDate()).padStart(2,"0");
  return `${y}-${m}-${d}`;
}

const SLOTS = ["Morning","Evening"];
const SLOT_STYLE = {
  Morning: { color:"#d97706", bg:"#fef3c7", icon:"üåÖ" },
  Evening: { color:"#7c3aed", bg:"#ede9fe", icon:"üåô" },
};

// Same script URL ‚Äî pass sheetName to separate data
const SATSANG_SHEET = "Satsang";   // name of the sheet tab in your spreadsheet
const satsangApi = {
  async getAll() {
    const r = await fetch(`${SCRIPT_URL}?action=getAll&apiKey=${API_KEY}&sheetName=${SATSANG_SHEET}`);
    return r.json();
  },
  async post(b) {
    const r = await fetch(SCRIPT_URL, {
      method:"POST", body:JSON.stringify({...b, apiKey:API_KEY, sheetName:SATSANG_SHEET})
    });
    return r.json();
  },
  async delete(id) {
    const r = await fetch(SCRIPT_URL, {
      method:"POST", body:JSON.stringify({ action:"delete", id, apiKey:API_KEY, sheetName:SATSANG_SHEET })
    });
    return r.json();
  }
};

// Photo upload via Apps Script
const photoApi = {
  async upload(base64, filename, caption, uploader) {
    const r = await fetch(SCRIPT_URL, {
      method:"POST", body:JSON.stringify({
        action:"uploadPhoto", apiKey:API_KEY,
        base64, filename, caption, uploader
      })
    });
    return r.json();
  },
  async getAll() {
    const r = await fetch(`${SCRIPT_URL}?action=getPhotos&apiKey=${API_KEY}`);
    return r.json();
  }
};

// isConfigured is now computed inside App component (see below)

const api = {
  async getAll() {
    const r = await fetch(`${SCRIPT_URL}?action=getAll&apiKey=${API_KEY}`);
    return r.json();
  },
  async post(b) {
    const r = await fetch(SCRIPT_URL, {
      method:"POST", body:JSON.stringify({...b, apiKey:API_KEY})
    });
    return r.json();
  }
};

// ‚îÄ‚îÄ Blue divider ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const BlueDivider = () => (
  <div style={{ display:"flex", alignItems:"center", gap:10, margin:"6px 0 16px" }}>
    <div style={{ flex:1, height:"1px", background:"linear-gradient(90deg,transparent,rgba(59,130,246,0.4))" }}/>
    <span style={{ color:"rgba(59,130,246,0.45)", fontSize:14 }}>‚ú¶</span>
    <div style={{ flex:1, height:"1px", background:"linear-gradient(90deg,rgba(59,130,246,0.4),transparent)" }}/>
  </div>
);

// ‚îÄ‚îÄ Skeleton card shown while data is loading ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function SkeletonCard({ rows = 3, style = {} }) {
  return (
    <div className="skeleton-card" style={style}>
      {/* Header row */}
      <div style={{ display:"flex", alignItems:"center", gap:10 }}>
        <div className="skeleton" style={{ width:36, height:36, borderRadius:"50%", flexShrink:0 }}/>
        <div style={{ flex:1, display:"flex", flexDirection:"column", gap:6 }}>
          <div className="skeleton" style={{ height:13, width:"55%", borderRadius:6 }}/>
          <div className="skeleton" style={{ height:10, width:"35%", borderRadius:6 }}/>
        </div>
      </div>
      {/* Content rows */}
      {Array.from({length: rows}).map((_,i) => (
        <div key={i} className="skeleton" style={{
          height:11, borderRadius:6,
          width: i === rows-1 ? "45%" : i % 2 === 0 ? "80%" : "65%"
        }}/>
      ))}
      {/* Button row */}
      <div className="skeleton" style={{ height:38, borderRadius:10, marginTop:4 }}/>
    </div>
  );
}

// ‚îÄ‚îÄ Full page data loader overlay ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function DataLoadingOverlay() {
  return (
    <div style={{
      position:"fixed", inset:0, zIndex:50,
      display:"flex", flexDirection:"column",
      alignItems:"center", justifyContent:"center",
      background:"rgba(232,240,254,0.85)",
      backdropFilter:"blur(6px)",
      animation:"fadeSlideIn 0.3s ease-out both",
    }}>
      {/* Lotus spinner */}
      <div style={{
        fontSize:44, marginBottom:16,
        animation:"floatEmoji 1.2s ease-in-out infinite alternate",
        filter:"drop-shadow(0 0 18px rgba(255,180,0,0.55))",
      }}>ü™∑</div>

      {/* Animated dots */}
      <div style={{ display:"flex", gap:7, marginBottom:14 }}>
        {[0,1,2].map(i => (
          <div key={i} style={{
            width:9, height:9, borderRadius:"50%",
            background:"#3b82f6",
            animation:"dotPulse 1.2s ease-in-out infinite",
            animationDelay: i * 0.2 + "s",
            opacity:0.7,
          }}/>
        ))}
      </div>

      <div style={{
        fontFamily:"'Cinzel',serif", fontSize:13, fontWeight:700,
        color:"rgba(29,78,216,0.65)", letterSpacing:"1.5px",
      }}>Loading your Kendra data...</div>

      <div style={{
        fontSize:11, color:"rgba(29,78,216,0.38)", marginTop:6,
        letterSpacing:"0.5px",
      }}>Jayguru üôè</div>
    </div>
  );
}


function App({ onChangeSuk }) {
  // Merge DEFAULT_FEATURES with this SUK's overrides
  const feat = React.useMemo(() => ({
    ...DEFAULT_FEATURES,
    ...(ACTIVE_SUK && ACTIVE_SUK.features ? ACTIVE_SUK.features : {}),
  }), []);

  // isConfigured: reactive ‚Äî true only when a real SUK is loaded with a valid URL
  const isConfigured = !!(ACTIVE_SUK && ACTIVE_SUK.configured &&
    SCRIPT_URL && SCRIPT_URL !== "" && !SCRIPT_URL.startsWith("YOUR_"));
  const [bookings,   setBookings]   = React.useState([]);
  const [form,       setForm]       = React.useState({ name:"", mobile:"", place:"", time:"", date:"" });

  const [error,      setError]      = React.useState("");
  const [shake,      setShake]      = React.useState(false);
  const [activeTab,  setActiveTab]  = React.useState("book");
  const [bookMode,   setBookMode]   = React.useState("prayer"); // "prayer" | "satsang"
  // Reset bookMode if current mode is disabled for this SUK
  React.useEffect(() => {
    if (feat && !feat.satsangBooking && bookMode === "satsang") setBookMode("prayer");
  }, [feat, bookMode]);
  const [loading,    setLoading]    = React.useState(false);
  const [dataReady,  setDataReady]  = React.useState(false); // true once initial data loaded
  const [submitting, setSubmitting] = React.useState(false);
  const [confirmation, setConfirmation] = React.useState(null);
  const [showCancel, setShowCancel] = React.useState(false);
  // Cancel flow
  const [cancelMobile, setCancelMobile] = React.useState("");
  const [cancelResults, setCancelResults] = React.useState(null);
  const [cancelMsg, setCancelMsg] = React.useState("");
  const [cancelling, setCancelling] = React.useState(null); // stores the ID being cancelled
  // Retrieve & reshare
  const [shareMobile, setShareMobile] = React.useState("");
  const [shareResults, setShareResults] = React.useState(null);
  const [shareMsg, setShareMsg] = React.useState("");
  // Announcements
  // Satsang Booking state
  const [satsangBookings, setSatsangBookings] = React.useState([]);
  const [satsangLoadingData, setSatsangLoadingData] = React.useState(false);
  const [satsangForm, setSatsangForm] = React.useState({ name:"", mobile:"", venue:"", date:"", time:"", hostedBy:"", mapsLink:"" });
  const [satsangError, setSatsangError] = React.useState("");
  const [satsangShake, setSatsangShake] = React.useState(false);
  const [satsangSubmitting, setSatsangSubmitting] = React.useState(false);
  const [satsangConfirm, setSatsangConfirm] = React.useState(null);
  const [satsangCalDate, setSatsangCalDate] = React.useState(() => {
    const t = new Date(); t.setHours(0,0,0,0);
    return `${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`;
  });

  // Satsang sub-mode: "book" | "invite" | "message"
  const [satsangMode, setSatsangMode] = React.useState("book");

  // Message Creator state
  const [msgType, setMsgType]   = React.useState("");

  // Photo gallery state
  const [photos, setPhotos]       = React.useState([]);
  const [photosLoading, setPhotosLoading] = React.useState(false);
  const [photoUpload, setPhotoUpload] = React.useState({ caption:"", uploader:"", file:null, preview:null });
  const [photoUploading, setPhotoUploading] = React.useState(false);
  const [photoMsg, setPhotoMsg]   = React.useState("");
  // Jajan experience
  const [jajan, setJajan] = React.useState({ name:"", place:"", date:"", experience:"", link:"" });
  const [satsang, setSatsang]   = React.useState({ date:"", time:"", venue:"", mapsLink:"", hostedBy:"" });
  const [customMsg, setCustomMsg] = React.useState({ body:"", author:"" });
  const [msgPreview, setMsgPreview] = React.useState("");

  // Address edit
  const [editingAddress, setEditingAddress] = React.useState(null);
  const [editAddressVal, setEditAddressVal] = React.useState("");
  const [savingAddress, setSavingAddress] = React.useState(false);
  const [addressMsg, setAddressMsg] = React.useState({});

  const fetchBookings = React.useCallback(async () => {
    if (!isConfigured) return;
    setLoading(true);
    try {
      const d = await api.getAll();
      if (d.success && Array.isArray(d.data)) setBookings(d.data);
      else if (Array.isArray(d)) setBookings(d);
    } catch(e) {}
    setLoading(false);
    setDataReady(true);
  }, []);

  React.useEffect(() => { fetchBookings(); }, [fetchBookings]);

  // ‚îÄ‚îÄ Warm invitation share message ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const buildShareMsgPlain = (c) => {
    const timeLabel = c.time === "Morning" ? "Morning" : "Evening";
    const locationLine = c.place || (ACTIVE_SUK ? sukLabel(ACTIVE_SUK)+(ACTIVE_SUK.location ? ", "+ACTIVE_SUK.location : "") : "Satsang Upayojana Kendra");
    const lines = [
      "Jayguru üôè",
      "",
      "You're cordially invited! üôè",
      "",
      `for the *${timeLabel} Prayer*`,
      `on *${formatDateWithDay(c.date)}* at *${cleanTime(c.prayerTime)}*`,
      "",
      "Please join us with your family and friends üôè",
      "",
      `Prayer starts at *${cleanTime(c.prayerTime)}* sharp.`,
      `Address: ${locationLine}`,
      "",
      "Regards,",
      `${c.name} üôè`,
      "",
      "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ",
      `üôè ${ACTIVE_SUK ? sukLabel(ACTIVE_SUK)+(ACTIVE_SUK.location ? ", "+ACTIVE_SUK.location : "") : "Satsang Upayojana Kendra"}`,
    ];
    return lines.join("\n");
  };

  const buildShareMsg = (c) => encodeURIComponent(buildShareMsgPlain(c));

  // ‚îÄ‚îÄ Format satsang time safely (handles string and Date object) ‚îÄ‚îÄ

  // Mask mobile for privacy ‚Äî show only last 4 digits
  const maskMobile = (m) => {
    const s = String(m||"").replace(/\D/g,"");
    if (s.length < 4) return "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
    return "‚Ä¢".repeat(s.length - 4) + s.slice(-4);
  };
  const fmtSatsangTime = (t) => {
    if (!t) return "";
    return cleanTime(t);  // handles 1899 Google Sheets bug, strings, Date objects
  };

  // ‚îÄ‚îÄ Satsang booking share message ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const buildSatsangShareMsgPlain = (c) => {
    const day  = c.day || getDayName(c.date);
    const date = formatDate(c.date);
    const lines = [
      "üôè *Hearty Jayguru* üôè",
      "",
      "Respected Dada / Maa,",
      "",
      "By the divine grace of",
      "*Param Premamay Sree Sree Thakur Anukulchandra*,",
      "we are humbly arranging a *Holy Satsang* at our residence.",
      "",
      "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ",
      "üìÖ *Date & Time*",
      `      ${day}, ${date}  |  ${c.time} onwards`,
      "",
      "üìç *Venue*",
      `      ${c.venue}`,
      c.mapsLink ? `      üìå ${c.mapsLink}` : "",
      "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ",
      "",
      "We most cordially request your divine presence",
      "along with your *family and friends*. üå∏",
      "",
      "Your presence will make this Satsang truly blessed. ü™î",
      "",
      `*With love & Jayguru,*`,
      `${c.hostedBy || (ACTIVE_SUK ? sukLabel(ACTIVE_SUK) : "SUK")}`,
      "",
      `üôè *${ACTIVE_SUK ? sukLabel(ACTIVE_SUK)+(ACTIVE_SUK.location ? ", "+ACTIVE_SUK.location : "") : "Satsang Upayojana Kendra"}* üôè`,
    ].filter(l => l !== null);
    return lines.join("\n");
  };
  const buildSatsangShareMsg = (c) => encodeURIComponent(buildSatsangShareMsgPlain(c));

  const handleSatsangCopy = (c) => {
    const msg = buildSatsangShareMsgPlain(c);
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(msg)
        .then(() => alert("‚úÖ Copied! Paste it in WhatsApp, SMS or anywhere."))
        .catch(() => prompt("Copy this message:", msg));
    } else {
      prompt("Copy this message:", msg);
    }
  };

  const handleCopy = (c) => {
    const msg = buildShareMsgPlain(c);
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(msg)
        .then(() => alert("‚úÖ Copied! Paste it in WhatsApp, SMS or anywhere."))
        .catch(() => prompt("Copy this message:", msg));
    } else {
      prompt("Copy this message:", msg);
    }
  };

  // ‚îÄ‚îÄ Cancel lookup by mobile ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const handleCancelLookup = () => {
    setCancelMsg("");
    setCancelResults(null);
    if (!/^[0-9]{10}$/.test(cancelMobile.trim())) {
      setCancelMsg("‚ö†Ô∏è Please enter a valid 10-digit mobile number.");
      return;
    }
    const mob = cancelMobile.trim();
    const prayerFound  = bookings.filter(b => b.mobile === mob).map(b => ({ ...b, _type:"prayer" }));
    const satsangFound = satsangBookings.filter(b => b.mobile === mob).map(b => ({ ...b, _type:"satsang" }));
    const combined = [...prayerFound, ...satsangFound].sort((a,b)=>(b.date||"").localeCompare(a.date||""));
    if (combined.length === 0) {
      setCancelMsg("‚ùå No bookings found for this mobile number.");
      setCancelResults([]);
    } else {
      setCancelResults(combined);
    }
  };

  const handleCancelBooking = async (id) => {
    if (!window.confirm("Are you sure you want to cancel this booking?")) return;
    setCancelling(id);
    try {
      const result = await api.post({ action:"delete", id });
      if (result.success) {
        const successMsg = "‚úÖ Booking cancelled successfully.";
        setCancelMsg(successMsg);
        setShareMsg(successMsg);
        // Null-safe filter ‚Äî avoids crash if called from retrieve tab (shareResults) or cancel tab (cancelResults)
        setCancelResults(prev => Array.isArray(prev) ? prev.filter(b => b.id !== id) : prev);
        setShareResults(prev => Array.isArray(prev) ? prev.filter(b => b.id !== id) : prev);
        fetchBookings();
      } else {
        const errMsg = "‚ùå Could not cancel. Please try again.";
        setCancelMsg(errMsg);
        setShareMsg(errMsg);
      }
    } catch(e) {
      const errMsg = "‚ùå Network error.";
      setCancelMsg(errMsg);
      setShareMsg(errMsg);
    }
    setCancelling(null);
  };

  const handleUpdateAddress = async (bookingId, newAddress) => {
    setSavingAddress(true);
    try {
      const isLink = newAddress.startsWith("http") || newAddress.includes("maps.google") ||
                     newAddress.includes("goo.gl") || newAddress.includes("maps.app");
      const result = await api.post({
        action: "updateAddress",
        id:     bookingId,
        place:  newAddress,   // store as-is ‚Äî text or maps link, all goes to Place column
      });
      if (result.success) {
        // Update local state ‚Äî place field stores both text address and maps links
        setShareResults(prev => prev.map(b =>
          b.id === bookingId ? { ...b, place: newAddress } : b
        ));
        // also update bookings state so cancel section is fresh
        setAddressMsg(prev => ({ ...prev, [bookingId]: "‚úÖ Address updated!" }));
        setEditingAddress(null);
        fetchBookings();
        setTimeout(() => setAddressMsg(prev => { const n={...prev}; delete n[bookingId]; return n; }), 3000);
      } else {
        setAddressMsg(prev => ({ ...prev, [bookingId]: "‚ùå " + result.message }));
      }
    } catch(e) {
      setAddressMsg(prev => ({ ...prev, [bookingId]: "‚ùå Network error." }));
    }
    setSavingAddress(false);
  };

  const buildSatsangMsg = () => {
    const { date, time, venue, mapsLink, hostedBy } = satsang;
    const lines = [
      "üôè *Hearty Jayguru* üôè",
      "",
      "Respected Dada / Maa,",
      "",
      "By the divine grace of",
      "*Param Premamay Sree Sree Thakur Anukulchandra*,",
      "we are humbly arranging a *Holy Satsang* at our residence.",
      "",
      "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ",
      "üìÖ *Date & Time*",
    ];
    if (date) lines.push(`      ${date}${time ? "  |  " + time + " onwards" : ""}`);
    lines.push("");
    lines.push("üìç *Venue*");
    if (venue) lines.push(`      ${venue}`);
    if (mapsLink) lines.push(`      üìå ${mapsLink}`);
    lines.push("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ");
    lines.push("");
    lines.push("We most cordially request your divine presence");
    lines.push("along with your *family and friends*. üå∏");
    lines.push("");
    lines.push("Your presence will make this Satsang truly blessed. ü™∑");
    lines.push("");
    if (hostedBy) {
      lines.push("*With love & Jayguru,*");
      lines.push(hostedBy);
    }
    lines.push("");
    lines.push(`üôè *${ACTIVE_SUK ? sukLabel(ACTIVE_SUK)+(ACTIVE_SUK.location ? ", "+ACTIVE_SUK.location : "") : "Satsang Upayojana Kendra"}* üôè`);
    return lines.join("\n");
  };

  const buildCustomMsg = () => {
    const lines = [
      "üôè *Hearty Jayguru* üôè",
      "",
      customMsg.body.trim(),
      "",
      "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ",
    ];
    if (customMsg.author.trim()) lines.push(`*${customMsg.author.trim()}*`);
    lines.push(`üôè *${ACTIVE_SUK ? sukLabel(ACTIVE_SUK)+(ACTIVE_SUK.location ? ", "+ACTIVE_SUK.location : "") : "Satsang Upayojana Kendra"}* üôè`);
    return lines.join("\n");
  };

  const getBuiltMsg = () => msgType === "satsang" ? buildSatsangMsg() : buildCustomMsg();

  const buildJajanMsg = () => {
    const { name, place, date, experience } = jajan;
    return [
      "Jayguru üôè",
      "",
      "üå∏ *Jajan Experience*",
      "",
      experience.trim(),
      "",
      jajan.link.trim() ? `üîó ${jajan.link.trim()}`                         : "",
      name.trim()    ? `‚Äî ${name.trim()}`                                    : "",
      place.trim()   ? `üìç ${place.trim()}`                                  : "",
      date           ? `üìÖ ${getDayName(date)}, ${formatDate(date)}`         : "",
      "",
      "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ",
      `üôè ${ACTIVE_SUK ? sukLabel(ACTIVE_SUK)+(ACTIVE_SUK.location ? ", "+ACTIVE_SUK.location : "") : "Satsang Upayojana Kendra"}`,
    ].filter((l, i, arr) => !(l === "" && arr[i-1] === "")).join("\n");
  };

  const shareWhatsApp = (msg) => window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, "_blank");
  const shareSMS      = (msg) => window.open(`sms:?body=${encodeURIComponent(msg)}`);
  const shareCopy     = (msg) => {
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(msg)
        .then(() => alert("‚úÖ Copied! Paste it anywhere."))
        .catch(() => prompt("Copy:", msg));
    } else { prompt("Copy:", msg); }
  };

  const handleShareLookup = () => {
    setShareMsg("");
    setShareResults(null);
    if (!/^[0-9]{10}$/.test(shareMobile.trim())) {
      setShareMsg("‚ö†Ô∏è Please enter a valid 10-digit mobile number.");
      return;
    }
    const mob = shareMobile.trim();
    // Search BOTH prayer and satsang bookings
    const prayerFound   = bookings.filter(b => b.mobile === mob).map(b => ({ ...b, _type:"prayer" }));
    const satsangFound  = satsangBookings.filter(b => b.mobile === mob).map(b => ({ ...b, _type:"satsang" }));
    const combined = [...prayerFound, ...satsangFound]
      .sort((a,b) => (b.date||"").localeCompare(a.date||"")); // newest first
    if (combined.length === 0) {
      setShareMsg("‚ùå No bookings found for this mobile number.");
      setShareResults([]);
    } else {
      setShareResults(combined);
    }
  };

  // Cancel a satsang booking
  const handleCancelSatsang = async (id) => {
    if (!window.confirm("Are you sure you want to cancel this Satsang booking?")) return;
    setCancelling(id);
    try {
      const result = await satsangApi.delete(id);
      if (result.success) {
        const successMsg = "‚úÖ Satsang cancelled successfully.";
        // Update BOTH cancel and retrieve states safely (null-check before .filter)
        setCancelMsg(successMsg);
        setShareMsg(successMsg);
        setCancelResults(prev => Array.isArray(prev) ? prev.filter(b => b.id !== id) : prev);
        setShareResults(prev => Array.isArray(prev) ? prev.filter(b => b.id !== id) : prev);
        fetchSatsangBookings();
      } else {
        const errMsg = "‚ùå Could not cancel: " + (result.message||"Please try again.");
        setCancelMsg(errMsg);
        setShareMsg(errMsg);
      }
    } catch(e) {
      const errMsg = "‚ùå Network error. Please try again.";
      setCancelMsg(errMsg);
      setShareMsg(errMsg);
    }
    setCancelling(null);
  };

  // ‚îÄ‚îÄ Fetch satsang bookings ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const fetchSatsangBookings = React.useCallback(async () => {
    if (!isConfigured) return;
    setSatsangLoadingData(true);
    try {
      const d = await satsangApi.getAll();
      if (d.success && Array.isArray(d.data)) setSatsangBookings(d.data);
      else if (Array.isArray(d)) setSatsangBookings(d);
    } catch(e) {}
    setSatsangLoadingData(false);
  }, []);

  React.useEffect(() => { fetchSatsangBookings(); }, [fetchSatsangBookings]);

  const triggerSatsangError = (msg) => {
    setSatsangError(msg); setSatsangShake(true);
    setTimeout(() => setSatsangShake(false), 600);
  };

  const handleSatsangSubmit = async () => {
    const { name, mobile, venue, date, time } = satsangForm;
    if (!name.trim())   { triggerSatsangError("‚ö†Ô∏è Please enter the host's name."); return; }
    if (!mobile.trim()) { triggerSatsangError("‚ö†Ô∏è Please enter the mobile number."); return; }
    if (!/^[0-9]{10}$/.test(mobile.trim())) { triggerSatsangError("‚ö†Ô∏è Valid 10-digit mobile required."); return; }
    if (!date)          { triggerSatsangError("‚ö†Ô∏è Please select a date."); return; }
    if (date < getTodayStr()) { triggerSatsangError("‚ö†Ô∏è Please select today or a future date."); return; }
    if (!time.trim())   { triggerSatsangError("‚ö†Ô∏è Please enter the time."); return; }
    if (!venue.trim())  { triggerSatsangError("‚ö†Ô∏è Please enter the venue."); return; }
    if (!isConfigured) { triggerSatsangError("‚ö†Ô∏è Please configure the Satsang Script URL."); return; }

    setSatsangSubmitting(true);
    try {
      const result = await satsangApi.post({
        action:"add",
        name: name.trim(),
        mobile: mobile.trim(),
        venue: venue.trim(),
        date, time: time.trim(),
        hostedBy: satsangForm.hostedBy.trim() || (ACTIVE_SUK ? sukLabel(ACTIVE_SUK) : "SUK"),
        mapsLink: satsangForm.mapsLink.trim(),
        day: getDayName(date),
      });
      if (result.success) {
        setSatsangConfirm({ ...satsangForm, id: result.id, day: getDayName(date) });
        setSatsangForm({ name:"", mobile:"", venue:"", date:"", time:"", hostedBy:"", mapsLink:"" });
        fetchSatsangBookings();
      } else { triggerSatsangError(result.message || "‚ö†Ô∏è Booking failed. Please try again."); }
    } catch(e) { triggerSatsangError("‚ö†Ô∏è Network error. Please try again."); }
    setSatsangSubmitting(false);
  };

  // ‚îÄ‚îÄ Photo gallery ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const fetchPhotos = React.useCallback(async () => {
    if (!isConfigured) return;
    setPhotosLoading(true);
    try {
      const d = await photoApi.getAll();
      if (d.success && Array.isArray(d.data)) setPhotos(d.data);
      else if (Array.isArray(d)) setPhotos(d);
    } catch(e) {}
    setPhotosLoading(false);
  }, []);

  React.useEffect(() => { fetchPhotos(); }, [fetchPhotos]);

  const handlePhotoUpload = async () => {
    if (!photoUpload.file) { setPhotoMsg("‚ö†Ô∏è Please select a photo first."); return; }
    if (!isConfigured)     { setPhotoMsg("‚ö†Ô∏è Script URL not configured."); return; }
    setPhotoUploading(true); setPhotoMsg("");
    try {
      const reader = new FileReader();
      reader.onload = async (ev) => {
        const base64 = ev.target.result.split(",")[1];
        const res = await photoApi.upload(
          base64,
          photoUpload.file.name,
          photoUpload.caption.trim(),
          photoUpload.uploader.trim() || "Anonymous"
        );
        if (res.success) {
          setPhotoMsg("‚úÖ Photo uploaded!");
          setPhotoUpload({ caption:"", uploader:"", file:null, preview:null });
          fetchPhotos();
        } else { setPhotoMsg("‚ö†Ô∏è " + (res.message || "Upload failed")); }
        setPhotoUploading(false);
      };
      reader.readAsDataURL(photoUpload.file);
    } catch(e) { setPhotoMsg("‚ö†Ô∏è Upload failed. Please try again."); setPhotoUploading(false); }
  };

  const prayerTimes    = getPrayerTimes(form.date);
  const isSlotTaken    = (date, time) => bookings.some(b => b.date===date && b.time===time);
  const getSlotBooking = (date, time) => bookings.find(b => b.date===date && b.time===time);

  const triggerError = (msg) => {
    setError(msg); setShake(true);
    setTimeout(() => setShake(false), 450);
  };

  const handleSlotSelect = (time) => {
    if (form.date && isSlotTaken(form.date, time)) {
      const ex = getSlotBooking(form.date, time);
      triggerError(`üö´ "${time} Prayer" on ${formatDate(form.date)} is already booked by ${ex.name}.\n\nPlease choose a different date or slot.`);
      return;
    }
    setError("");
    setForm(f => ({ ...f, time }));
  };

  const handleBook = async () => {
    setError("");
    const { name, mobile, place, time, date } = form;
    if (!name.trim())   { triggerError("‚ö†Ô∏è Please enter the person's name."); return; }
    if (!mobile.trim()) { triggerError("‚ö†Ô∏è Please enter the mobile number."); return; }
    if (!/^[0-9]{10}$/.test(mobile.trim())) { triggerError("‚ö†Ô∏è Please enter a valid 10-digit mobile number."); return; }
    if (!form.place.trim())  { triggerError("‚ö†Ô∏è Please enter your location name."); return; }
    if (!date)          { triggerError("‚ö†Ô∏è Please select a date."); return; }
    if (date < getTodayStr()) { triggerError("‚ö†Ô∏è You cannot book a past date. Please select today or a future date."); return; }
    if (!time)          { triggerError("‚ö†Ô∏è Please select Morning or Evening slot."); return; }
    if (isSlotTaken(date, time)) {
      const ex = getSlotBooking(date, time);
      triggerError(`üö´ "${time} Prayer" on ${formatDate(date)} is already booked by ${ex.name}.\n\nPlease choose a different date or slot.`);
      return;
    }
    if (!isConfigured) { triggerError("‚ö†Ô∏è Please add your Google Apps Script URL first."); return; }

    const day        = getDayName(date);
    const pt         = getPrayerTimes(date);
    const prayerTime = pt ? pt[time] : "";

    setSubmitting(true);
    try {
      const result = await api.post({ action:"add", name, mobile, place, day, time, date, prayerTime });
      if (result.success) {
        // Show beautiful confirmation modal
        setConfirmation({ name, mobile, time, date, prayerTime, id: result.id, place });
        setForm({ name:"", mobile:"", place:"", time:"", date:"" });
        fetchBookings();
      } else { triggerError(result.message); }
    } catch(e) { triggerError("‚ö†Ô∏è Network error. Please try again."); }
    setSubmitting(false);
  };

  const tabs = [
    { id:"book",   label:"üôè Book" },
    { id:"manage", label:"üìã More Options" },
  ];
  // Only show manage sub-tabs that are enabled for this SUK
  const manageTabs = [
    feat.prayerTimes     && { id:"times",    label:"üôè Prayer Timings",     desc:"View morning & evening prayer times",   icon:"üôè" },
    feat.retrieveBooking && { id:"share",    label:"ü™∑ Retrieve Booking",    desc:"Retrieve your booking details",          icon:"ü™∑" },
    feat.allBookings     && { id:"all",      label:"üìñ All Bookings",        desc:"See all prayer bookings by date",       icon:"üìñ" },
    feat.messages        && { id:"announce", label:"üì® Messages",             desc:"Create invitations & custom messages",   icon:"üì®" },
    feat.photoGallery    && { id:"gallery",  label:"üå∏ Prayer Photo Gallery", desc:"Upload & view prayer photo memories",   icon:"üå∏" },
  ].filter(Boolean);
  const [manageTab, setManageTab] = React.useState(null);
  const [calDate,   setCalDate]   = React.useState(() => {
    const t = new Date(); t.setHours(0,0,0,0);
    return `${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`;
  });

  const blueText   = { color:"#1e3a8a" };
  const mutedBlue  = { color:"rgba(30,64,175,0.6)" };
  const darkText   = { color:"#1f2937" };

  return (
    <div className="content">

      {/* ‚îÄ‚îÄ DATA LOADING OVERLAY ‚îÄ‚îÄ */}
      {isConfigured && !dataReady && <DataLoadingOverlay />}

      {/* ‚îÄ‚îÄ CONFIRMATION MODAL ‚îÄ‚îÄ */}
      {confirmation && (
        <div className="modal-overlay" onClick={() => setConfirmation(null)}>
          <div className="modal-box" onClick={e => e.stopPropagation()}>

            {/* Animated tick */}
            <div style={{ fontSize:56, marginBottom:8,
              animation:"floatEmoji 2s ease-in-out infinite alternate" }}>üôè</div>

            <div className="modal-title">Booking Confirmed!</div>

            {/* Booking details card */}
            <div style={{ background:"#eff6ff", borderRadius:14, padding:"14px 16px",
              margin:"14px 0", textAlign:"left", border:"1px solid rgba(59,130,246,0.2)" }}>

              {[
                ["üë§ Name",  confirmation.name],
                [confirmation.time==="Morning" ? "üåÖ Slot" : "üåô Slot",
                  `${confirmation.time} Prayer`],
                ["üóìÔ∏è Date",  formatDateWithDay(confirmation.date)],
                ["üïê Time",  cleanTime(confirmation.prayerTime)],
              ].map(([label, val]) => (
                <div key={label} style={{ display:"flex", justifyContent:"space-between",
                  alignItems:"center", padding:"5px 0",
                  borderBottom:"1px solid rgba(59,130,246,0.08)" }}>
                  <span style={{ fontSize:12, color:"rgba(29,78,216,0.55)", fontWeight:600 }}>{label}</span>
                  <span style={{ fontSize:13, color:"#1e3a8a", fontWeight:700 }}>{val}</span>
                </div>
              ))}
            </div>

            <div className="modal-jayguru">Jayguru üôè</div>

            {/* ‚îÄ‚îÄ SHARE SECTION ‚îÄ‚îÄ */}
            <div style={{ marginTop:18, padding:"14px", background:"#f0fdf4",
              borderRadius:12, border:"1px solid #bbf7d0" }}>
              <div style={{ fontSize:12, fontWeight:700, color:"#065f46",
                marginBottom:10, textAlign:"center", letterSpacing:"0.5px" }}>
                üì§ Share Booking Details
              </div>

              <div style={{ display:"flex", flexDirection:"column", gap:8 }}>

                {/* WhatsApp share */}
                <a href={`https://wa.me/?text=${buildShareMsg(confirmation)}`}
                  target="_blank" rel="noopener noreferrer"
                  style={{ display:"flex", alignItems:"center", justifyContent:"center",
                    gap:10, padding:"12px", borderRadius:11, textDecoration:"none",
                    background:"linear-gradient(135deg,#25D366,#128C7E)",
                    color:"#fff", fontWeight:800, fontSize:14,
                    boxShadow:"0 4px 14px rgba(37,211,102,0.35)" }}>
                  <span style={{ fontSize:20 }}>üí¨</span>
                  Share on WhatsApp
                </a>

                {/* SMS share ‚Äî works on mobile */}
                <a href={`sms:${confirmation.mobile}?body=${buildShareMsg(confirmation)}`}
                  style={{ display:"flex", alignItems:"center", justifyContent:"center",
                    gap:10, padding:"12px", borderRadius:11, textDecoration:"none",
                    background:"linear-gradient(135deg,#1d4ed8,#3b82f6)",
                    color:"#fff", fontWeight:800, fontSize:14,
                    boxShadow:"0 4px 14px rgba(29,78,216,0.3)" }}>
                  <span style={{ fontSize:20 }}>üì±</span>
                  Send as SMS
                </a>

                {/* Copy to clipboard */}
                <button onClick={() => handleCopy(confirmation)}
                  style={{ display:"flex", alignItems:"center", justifyContent:"center",
                    gap:10, padding:"12px", borderRadius:11, border:"none",
                    background:"rgba(30,64,175,0.08)", cursor:"pointer",
                    color:"#1e3a8a", fontWeight:700, fontSize:14 }}>
                  <span style={{ fontSize:20 }}>üìã</span>
                  Copy to Clipboard
                </button>

              </div>
              <div style={{ fontSize:11, color:"#6b7280", marginTop:8,
                textAlign:"center", lineHeight:1.5 }}>
                Tap WhatsApp to share with family ¬∑ or SMS to send directly ¬∑ or Copy to paste anywhere
              </div>
            </div>

            <button className="modal-close-btn"
              style={{ marginTop:14 }}
              onClick={() => setConfirmation(null)}>
              ‚úì Done
            </button>
          </div>
        </div>
      )}

      {/* ‚îÄ‚îÄ SATSANG CONFIRMATION MODAL ‚îÄ‚îÄ */}
      {satsangConfirm && (
        <div className="modal-overlay" onClick={() => setSatsangConfirm(null)}>
          <div className="modal-box" onClick={e => e.stopPropagation()}>

            <div style={{ fontSize:56, marginBottom:8,
              animation:"floatEmoji 2s ease-in-out infinite alternate",
              filter:"drop-shadow(0 0 18px rgba(217,119,6,0.5))" }}>ü™î</div>

            <div className="modal-title" style={{ color:"#78350f" }}>Satsang Booked!</div>

            {/* Details card */}
            <div style={{ background:"#fef3c7", borderRadius:14, padding:"14px 16px",
              margin:"14px 0", textAlign:"left", border:"1px solid rgba(217,119,6,0.3)" }}>

              {[
                ["üë§ Host",   satsangConfirm.name],
                ["üìÖ Date",   (satsangConfirm.day||"")+", "+formatDate(satsangConfirm.date)],
                ["‚è∞ Time",   satsangConfirm.time+" onwards"],
                ["üìç Venue",  satsangConfirm.venue],
                ["üôè Hosted", satsangConfirm.hostedBy||(ACTIVE_SUK ? sukLabel(ACTIVE_SUK) : "SUK")],
              ].map(([label, val]) => val ? (
                <div key={label} style={{ display:"flex", justifyContent:"space-between",
                  alignItems:"flex-start", padding:"5px 0",
                  borderBottom:"1px solid rgba(217,119,6,0.1)" }}>
                  <span style={{ fontSize:12, color:"rgba(120,53,15,0.6)", fontWeight:600 }}>{label}</span>
                  <span style={{ fontSize:13, color:"#78350f", fontWeight:700,
                    textAlign:"right", maxWidth:"60%" }}>{val}</span>
                </div>
              ) : null)}
            </div>

            <div style={{ fontFamily:"'Cinzel',serif", color:"#78350f",
              fontSize:14, fontWeight:700, textAlign:"center", marginBottom:4 }}>
              Jayguru ü™î
            </div>

            {/* Share section */}
            <div style={{ marginTop:14, padding:"14px", background:"#fffbeb",
              borderRadius:12, border:"1px solid rgba(217,119,6,0.25)" }}>
              <div style={{ fontSize:12, fontWeight:700, color:"#78350f",
                marginBottom:10, textAlign:"center", letterSpacing:"0.5px" }}>
                üì§ Share Satsang Details
              </div>
              <div style={{ display:"flex", flexDirection:"column", gap:8 }}>

                <a href={`https://wa.me/?text=${buildSatsangShareMsg(satsangConfirm)}`}
                  target="_blank" rel="noopener noreferrer"
                  style={{ display:"flex", alignItems:"center", justifyContent:"center",
                    gap:10, padding:"12px", borderRadius:11, textDecoration:"none",
                    background:"linear-gradient(135deg,#25D366,#128C7E)",
                    color:"#fff", fontWeight:800, fontSize:14,
                    boxShadow:"0 4px 14px rgba(37,211,102,0.35)" }}>
                  <span style={{ fontSize:20 }}>üí¨</span>
                  Share on WhatsApp
                </a>

                <a href={`sms:?body=${buildSatsangShareMsg(satsangConfirm)}`}
                  style={{ display:"flex", alignItems:"center", justifyContent:"center",
                    gap:10, padding:"12px", borderRadius:11, textDecoration:"none",
                    background:"linear-gradient(135deg,#d97706,#fbbf24)",
                    color:"#fff", fontWeight:800, fontSize:14,
                    boxShadow:"0 4px 14px rgba(217,119,6,0.35)" }}>
                  <span style={{ fontSize:20 }}>üì±</span>
                  Send as SMS
                </a>

                <button onClick={() => handleSatsangCopy(satsangConfirm)}
                  style={{ display:"flex", alignItems:"center", justifyContent:"center",
                    gap:10, padding:"12px", borderRadius:11, border:"none",
                    background:"rgba(120,53,15,0.08)", cursor:"pointer",
                    color:"#78350f", fontWeight:700, fontSize:14 }}>
                  <span style={{ fontSize:20 }}>üìã</span>
                  Copy to Clipboard
                </button>

              </div>
              <div style={{ fontSize:11, color:"#6b7280", marginTop:8,
                textAlign:"center", lineHeight:1.5 }}>
                Share the invitation with family & friends üôè
              </div>
            </div>

            <button className="modal-close-btn"
              style={{ marginTop:14, background:"linear-gradient(135deg,#78350f,#d97706)" }}
              onClick={() => setSatsangConfirm(null)}>
              ‚úì Done
            </button>
          </div>
        </div>
      )}

      {/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */}
      <div style={{ textAlign:"center", padding:"48px 0 30px", position:"relative" }}>
        {/* Outer soft aura */}
        <div style={{ position:"absolute", top:"50%", left:"50%",
          transform:"translate(-50%,-50%)", width:360, height:220, borderRadius:"50%",
          background:"radial-gradient(ellipse,rgba(255,220,80,0.07) 0%,rgba(99,145,255,0.12) 45%,transparent 70%)",
          animation:"haloPulse 5s ease-in-out infinite alternate", pointerEvents:"none" }}/>

        {/* White lotus left + Pink lotus right ‚Äî flanking */}
        <div style={{ display:"flex", justifyContent:"center", alignItems:"flex-end",
          gap:0, marginBottom:2 }}>
          <span style={{ fontSize:28, opacity:0.55,
            filter:"saturate(0) brightness(2.2) drop-shadow(0 0 8px rgba(255,255,255,0.7))",
            animation:"floatEmoji 4s ease-in-out infinite alternate",
            animationDelay:"0.5s", display:"inline-block" }}>ü™∑</span>
          {/* Centre lotus ‚Äî large */}
          <span style={{ fontSize:68, display:"inline-block", margin:"0 4px",
            filter:"drop-shadow(0 0 22px rgba(255,160,0,0.6)) drop-shadow(0 0 55px rgba(255,100,150,0.25))",
            animation:"floatEmoji 3s ease-in-out infinite alternate" }}>ü™∑</span>
          <span style={{ fontSize:28, opacity:0.55,
            filter:"saturate(0) brightness(2.2) drop-shadow(0 0 8px rgba(255,255,255,0.7))",
            animation:"floatEmoji 4s ease-in-out infinite alternate",
            animationDelay:"1s", display:"inline-block" }}>ü™∑</span>
        </div>

        {/* JAYGURU */}
        <div style={{ marginTop:6 }}>
          <span className="jayguru-title">Jayguru</span>
        </div>

        {/* Gold + blue sacred ornament line */}
        <div style={{ display:"flex", alignItems:"center", justifyContent:"center",
          gap:8, margin:"10px 16px 8px" }}>
          <div style={{ flex:1, height:1,
            background:"linear-gradient(90deg,transparent,rgba(255,200,60,0.5),rgba(59,130,246,0.4))" }}/>
          <span style={{ fontSize:18,
            filter:"drop-shadow(0 0 8px rgba(255,180,0,0.7))",
            animation:"floatEmoji 3s ease-in-out infinite alternate",
            animationDelay:"1.5s" }}>üôè</span>
          <div style={{ flex:1, height:1,
            background:"linear-gradient(90deg,rgba(59,130,246,0.4),rgba(255,200,60,0.5),transparent)" }}/>
        </div>

        {/* Subtitle */}
        <p style={{ fontFamily:"'Cinzel',serif", color:"#1e3a8a",
          fontSize:13, fontWeight:700, letterSpacing:"2px", margin:0 }}>
          Book Your Prayer Slot
        </p>
        <p style={{ fontSize:10, color:"rgba(30,64,175,0.45)", fontWeight:600,
          letterSpacing:"4px", textTransform:"uppercase", marginTop:5 }}>
          {ACTIVE_SUK ? `${ACTIVE_SUK.emoji} ${sukLabel(ACTIVE_SUK)}${ACTIVE_SUK.location ? " ¬∑ "+ACTIVE_SUK.location : ""} ${ACTIVE_SUK.emoji}` : "ü™∑ Satsang Upayojana Kendra ü™∑"}
        </p>
        {/* SUK selector row in header ‚Äî dropdown to switch SUK inline */}
        {onChangeSuk && (() => {
          const on  = Object.values(feat).filter(Boolean).length;
          const off = Object.values(feat).filter(v => !v).length;
          return (
            <div style={{ marginTop:10, display:"flex", alignItems:"center",
              justifyContent:"center", gap:8, flexWrap:"wrap" }}>
              {/* Inline SUK dropdown ‚Äî highlighted pill */}
              <div style={{ position:"relative" }}>
                <select
                  defaultValue={ACTIVE_SUK ? ACTIVE_SUK.key : ""}
                  onChange={e => {
                    const suk = SUK_CONFIG[e.target.value];
                    if (!suk || !suk.configured) return;
                    SCRIPT_URL = suk.scriptUrl;
                    API_KEY    = suk.apiKey;
                    ACTIVE_SUK = suk;
                    try { sessionStorage.setItem("activeSuk", suk.key); } catch(ex) {}
                    onChangeSuk("switch", suk);
                  }}
                  style={{
                    padding:"7px 36px 7px 14px",
                    borderRadius:24, fontSize:11, fontWeight:800,
                    fontFamily:"'Cinzel',serif",
                    color:"#1e3a8a",
                    background:"linear-gradient(135deg,rgba(255,255,255,0.95),rgba(219,234,254,0.85))",
                    border:"1.5px solid rgba(29,78,216,0.35)",
                    outline:"none", cursor:"pointer",
                    appearance:"none", WebkitAppearance:"none",
                    boxShadow:"0 3px 14px rgba(29,78,216,0.18), 0 1px 4px rgba(0,0,0,0.06)",
                    backdropFilter:"blur(8px)",
                    letterSpacing:"0.2px",
                    transition:"box-shadow 0.2s",
                  }}>
                  {Object.values(SUK_CONFIG).map(s => (
                    <option key={s.key} value={s.key} disabled={!s.configured}>
                      {`ü™∑ ${sukLabel(s)}${s.location ? " ¬∑ "+s.location : ""}${!s.configured ? " (Soon)" : ""}`}
                    </option>
                  ))}
                </select>
                {/* Animated chevron */}
                <span style={{ position:"absolute", right:11, top:"50%",
                  transform:"translateY(-50%)",
                  fontSize:10, fontWeight:900,
                  color:"rgba(29,78,216,0.6)", pointerEvents:"none",
                  animation:"chevronBounce 2s ease-in-out infinite" }}>‚åÑ</span>
              </div>

            </div>
          );
        })()}
        {(bookings.length > 0 || satsangBookings.length > 0) && (
          <div style={{ display:"flex", alignItems:"center", justifyContent:"center",
            gap:8, marginTop:10, flexWrap:"wrap" }}>
            {bookings.length > 0 && (
              <div style={{ display:"inline-flex", alignItems:"center", gap:5,
                padding:"5px 12px", borderRadius:20,
                background:"rgba(29,78,216,0.07)",
                border:"1px solid rgba(29,78,216,0.14)" }}>
                <span style={{ fontSize:12 }}>üåÖ</span>
                <span style={{ fontSize:11, color:"rgba(29,78,216,0.6)", fontWeight:700,
                  fontFamily:"'Cinzel',serif", letterSpacing:"0.5px" }}>
                  {bookings.length} Prayer{bookings.length!==1?"s":""}
                </span>
              </div>
            )}
            {feat.satsangBooking && satsangBookings.length > 0 && (
              <div style={{ display:"inline-flex", alignItems:"center", gap:5,
                padding:"5px 12px", borderRadius:20,
                background:"rgba(217,119,6,0.07)",
                border:"1px solid rgba(217,119,6,0.18)" }}>
                <span style={{ fontSize:12 }}>ü™î</span>
                <span style={{ fontSize:11, color:"rgba(120,53,15,0.65)", fontWeight:700,
                  fontFamily:"'Cinzel',serif", letterSpacing:"0.5px" }}>
                  {satsangBookings.length} Satsang{satsangBookings.length!==1?"s":""}
                </span>
              </div>
            )}
          </div>
        )}

        {/* Triple ornament dots */}
        <div style={{ display:"flex", alignItems:"center", justifyContent:"center",
          gap:8, margin:"14px 0 0" }}>
          <div style={{ width:40, height:1, background:"linear-gradient(90deg,transparent,rgba(255,200,60,0.4))" }}/>
          <span style={{ fontSize:9, color:"rgba(255,180,0,0.5)", letterSpacing:8 }}>‚ú¶ ‚ú¶ ‚ú¶</span>
          <div style={{ width:40, height:1, background:"linear-gradient(90deg,rgba(255,200,60,0.4),transparent)" }}/>
        </div>
      </div>

      {/* ‚îÄ‚îÄ Divine decorative strip ‚îÄ‚îÄ */}
      <div style={{ textAlign:"center", marginBottom:18, letterSpacing:14,
        fontSize:13, color:"rgba(29,78,216,0.3)",
        animation:"haloPulse 4s ease-in-out infinite alternate" }}>
        ‚ú¶ ü™∑ ‚ú¶
      </div>

      {/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */}
      <div style={{ display:"flex", gap:6, marginBottom: activeTab==="manage" ? 10 : 24,
        background:"rgba(255,255,255,0.7)", borderRadius:14,
        padding:5, border:"1px solid rgba(59,130,246,0.15)" }}>
        {tabs.map(t => (
          <button key={t.id}
            className={`tab-btn ${activeTab===t.id ? "active":"inactive"}`}
            onClick={() => { setActiveTab(t.id); if(t.id==="manage") setManageTab(null); }}>
            {t.label}
          </button>
        ))}
      </div>

      {/* ‚îÄ‚îÄ MANAGE SUB-TABS ‚îÄ‚îÄ */}
      {activeTab === "manage" && !manageTab && (
        <div className="card" style={{ padding:"6px 8px" }}>
          <div style={{ fontFamily:"'Cinzel',serif", ...blueText, fontSize:13, fontWeight:700,
            textAlign:"center", padding:"12px 0 10px", letterSpacing:1 }}>
            What would you like to do?
          </div>
          <div className="blue-line" style={{ marginBottom:8 }}/>
          {manageTabs.map((t, i) => (
            <button key={t.id} onClick={() => {
              setManageTab(t.id);
            }}
              style={{ display:"flex", alignItems:"center", gap:14, width:"100%",
                padding:"14px 16px", border:"none", borderRadius:14, cursor:"pointer",
                background:"transparent", textAlign:"left", transition:"all 0.18s",
                marginBottom: i < manageTabs.length-1 ? 2 : 0 }}
              onMouseEnter={e => e.currentTarget.style.background="rgba(29,78,216,0.06)"}
              onMouseLeave={e => e.currentTarget.style.background="transparent"}>
              <div style={{ width:44, height:44, borderRadius:12, flexShrink:0,
                background:"linear-gradient(135deg,rgba(29,78,216,0.1),rgba(59,130,246,0.08))",
                border:"1px solid rgba(59,130,246,0.15)",
                display:"flex", alignItems:"center", justifyContent:"center", fontSize:20 }}>
                <span style={{ filter: t.id==="share" ? "saturate(0) brightness(2.4) drop-shadow(0 0 4px rgba(255,255,255,0.6))" : "none" }}>
                  {t.icon}
                </span>
              </div>
              <div style={{ flex:1 }}>
                <div style={{ fontWeight:700, color:"#1e3a8a", fontSize:14 }}>
                  {t.label.split(" ").slice(1).join(" ")}
                </div>
                <div style={{ fontSize:12, color:"rgba(29,78,216,0.45)", marginTop:2 }}>
                  {t.desc}
                </div>
              </div>
              <div style={{ color:"rgba(29,78,216,0.3)", fontSize:18 }}>‚Ä∫</div>
            </button>
          ))}
        </div>
      )}

      {/* Back button when inside a manage sub-tab */}
      {activeTab === "manage" && manageTab && (
        <button onClick={() => setManageTab(null)}
          style={{ display:"flex", alignItems:"center", gap:6, background:"none",
            border:"none", cursor:"pointer", color:"rgba(29,78,216,0.6)",
            fontSize:13, fontWeight:700, padding:"0 2px 14px", letterSpacing:0.3 }}>
          ‚Äπ Back to More Options
        </button>
      )}

      {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BOOK TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
      {activeTab === "book" && (
        <div className="card">

          {/* Toggle pill ‚Äî only show satsang tab if feat.satsangBooking is on */}
          {(feat.prayerBooking && feat.satsangBooking) && (
            <div style={{ display:"flex", borderRadius:14, overflow:"hidden",
              border:"1.5px solid rgba(59,130,246,0.22)", marginBottom:20,
              background:"rgba(239,246,255,0.6)" }}>
              {[
                feat.prayerBooking  && { mode:"prayer",  icon:"üôè", label:"Prayer Booking" },
                feat.satsangBooking && { mode:"satsang", icon:"ü™î", label:"Satsang Booking" },
              ].filter(Boolean).map(t => (
                <button key={t.mode}
                  onClick={() => { setBookMode(t.mode); setError(""); setSatsangError(""); setSatsangConfirm(null); }}
                  style={{ flex:1, padding:"13px 8px", border:"none", cursor:"pointer",
                    fontFamily:"'Cinzel',serif", fontWeight:700, fontSize:13,
                    transition:"all 0.2s",
                    background: bookMode===t.mode
                      ? t.mode==="prayer"
                        ? "linear-gradient(135deg,#1d4ed8,#3b82f6)"
                        : "linear-gradient(135deg,#78350f,#d97706)"
                      : "transparent",
                    color: bookMode===t.mode ? "#fff" : "rgba(29,78,216,0.5)",
                    boxShadow: bookMode===t.mode ? "0 3px 12px rgba(0,0,0,0.18)" : "none" }}>
                  <span style={{ marginRight:6 }}>{t.icon}</span>{t.label}
                </button>
              ))}
            </div>
          )}


          {/* ‚îÄ‚îÄ Skeleton while initial data loads ‚îÄ‚îÄ */}
          {isConfigured && !dataReady && (
            <div style={{ display:"flex", flexDirection:"column", gap:12, marginTop:8 }}>
              <SkeletonCard rows={3} />
              <SkeletonCard rows={2} />
            </div>
          )}

          {/* ‚ïê‚ïê PRAYER FORM ‚ïê‚ïê */}
          {dataReady && bookMode === "prayer" && (
            <div style={{ display:"flex", flexDirection:"column", gap:18 }}>

              <div style={{ textAlign:"center", marginBottom:4 }}>
                <div style={{ fontFamily:"'Cinzel',serif", ...blueText, fontSize:16, fontWeight:700 }}>
                  Reserve a Prayer Slot
                </div>
                <div className="blue-line" style={{ marginTop:10 }}/>
              </div>

              <div>
                <label className="divine-label">üë§ Person's Name</label>
                <input className="divine-input" placeholder="Enter full name"
                  value={form.name}
                  onChange={e => { setError(""); setForm({...form, name:e.target.value}); }}/>
              </div>

              <div>
                <label className="divine-label">üì± Mobile Number</label>
                <input className="divine-input" placeholder="Enter 10-digit mobile number"
                  type="tel" maxLength="10"
                  value={form.mobile}
                  onChange={e => { setError(""); setForm({...form, mobile:e.target.value.replace(/[^0-9]/g,"")}); }}/>
              </div>

              <div>
                <label className="divine-label">üìç Location</label>
                <div style={{ position:"relative" }}>
                  <input className="divine-input"
                    placeholder="Type location name  OR  paste Google Maps link"
                    value={form.place}
                    onChange={e => {
                      const v = e.target.value;
                      setError("");
                      const isLink = v.startsWith("http") || v.includes("maps.google") || v.includes("goo.gl") || v.includes("maps.app");
                      setForm({...form, place:v, mapsLink: isLink ? v : form.mapsLink});
                    }}/>
                  {(form.place.startsWith("http") || form.place.includes("maps.google") || form.place.includes("goo.gl") || form.place.includes("maps.app")) && (
                    <a href={form.place} target="_blank" rel="noopener noreferrer"
                      style={{ position:"absolute", right:10, top:"50%", transform:"translateY(-50%)",
                        background:"#1d4ed8", color:"#fff", borderRadius:6, padding:"3px 8px",
                        fontSize:11, fontWeight:700, textDecoration:"none", whiteSpace:"nowrap" }}>
                      Open Map ‚Üó
                    </a>
                  )}
                </div>
              </div>

              <div>
                <label className="divine-label">üìÖ Date (optional ‚Äî or pick below)</label>
                <input type="date" className="divine-input" value={form.date} min={getTodayStr()}
                  style={{ fontSize:13, width:"100%", cursor:"pointer" }}
                  onChange={e => { setError(""); setForm({...form, date:e.target.value, time:""}); }}/>
                <div style={{ fontSize:10, color:"rgba(29,78,216,0.4)", marginTop:5, paddingLeft:2 }}>
                  ‚òùÔ∏è Tap a chip below for quick pick, or use the calendar for any future date
                </div>
              </div>

              {/* Date chips */}
              {(() => {
                const today2 = new Date(); today2.setHours(0,0,0,0);
                const chips2 = [];
                for (let i = 0; i < 14; i++) {
                  const d = new Date(today2); d.setDate(today2.getDate()+i);
                  const y = d.getFullYear(), m = String(d.getMonth()+1).padStart(2,"0"), dd = String(d.getDate()).padStart(2,"0");
                  const dateStr = `${y}-${m}-${dd}`;
                  const mTaken = isSlotTaken(dateStr,"Morning");
                  const eTaken = isSlotTaken(dateStr,"Evening");
                  const bothTaken = mTaken && eTaken;
                  const sel = form.date === dateStr;
                  chips2.push(
                    <button key={dateStr}
                      onClick={() => { setError(""); setForm({...form, date:dateStr, time:""}); }}
                      disabled={bothTaken}
                      style={{ display:"flex", flexDirection:"column", alignItems:"center",
                        padding:"8px 6px", borderRadius:12, flexShrink:0,
                        border:`2px solid ${sel?"#1d4ed8":bothTaken?"#fca5a5":mTaken||eTaken?"#fcd34d":"rgba(59,130,246,0.18)"}`,
                        background:sel?"#1d4ed8":bothTaken?"#fee2e2":mTaken||eTaken?"#fef3c7":"#f0f9ff",
                        cursor:bothTaken?"not-allowed":"pointer", minWidth:48,
                        opacity:bothTaken?0.6:1, transition:"all 0.15s",
                        boxShadow:sel?"0 3px 12px rgba(29,78,216,0.35)":"none" }}>
                      <div style={{ fontSize:9, fontWeight:700, textTransform:"uppercase",
                        color:sel?"rgba(255,255,255,0.8)":"#6b7280", letterSpacing:"0.5px" }}>
                        {i===0?"Today":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d.getDay()]}
                      </div>
                      <div style={{ fontSize:16, fontWeight:900, marginTop:2,
                        color:sel?"#fff":"#1e3a8a" }}>{dd}</div>
                      <div style={{ fontSize:8, marginTop:3, fontWeight:800,
                        color:sel?"rgba(255,255,255,0.9)":bothTaken?"#dc2626":mTaken||eTaken?"#d97706":"#16a34a" }}>
                        {bothTaken?"FULL":mTaken||eTaken?"1 LEFT":"FREE"}
                      </div>
                      <div style={{ display:"flex", gap:2, marginTop:4 }}>
                        <div style={{ width:5, height:5, borderRadius:"50%", background:mTaken?"#ef4444":"#22c55e" }}/>
                        <div style={{ width:5, height:5, borderRadius:"50%", background:eTaken?"#ef4444":"#22c55e" }}/>
                      </div>
                    </button>
                  );
                }
                return (
                  <div style={{ display:"flex", alignItems:"center", gap:6 }}>
                    <button onClick={() => { const el=document.getElementById("dateChipScroll"); if(el) el.scrollBy({left:-160,behavior:"smooth"}); }}
                      style={{ flexShrink:0, width:32, height:32, borderRadius:"50%", border:"none",
                        background:"linear-gradient(135deg,#1d4ed8,#3b82f6)", color:"#fff",
                        fontSize:18, cursor:"pointer", fontWeight:900, lineHeight:1 }}>‚Äπ</button>
                    <div id="dateChipScroll" style={{ display:"flex", gap:6, overflowX:"auto", flex:1,
                      paddingBottom:6, scrollbarWidth:"none" }}>
                      {chips2}
                    </div>
                    <button onClick={() => { const el=document.getElementById("dateChipScroll"); if(el) el.scrollBy({left:160,behavior:"smooth"}); }}
                      style={{ flexShrink:0, width:32, height:32, borderRadius:"50%", border:"none",
                        background:"linear-gradient(135deg,#1d4ed8,#3b82f6)", color:"#fff",
                        fontSize:18, cursor:"pointer", fontWeight:900, lineHeight:1 }}>‚Ä∫</button>
                  </div>
                );
              })()}

              {/* Slot selector */}
              {form.date ? (() => {
                const pt = getPrayerTimes(form.date);
                return (
                  <div className="fade-in">
                    <label className="divine-label">üåÖ Prayer Slot</label>
                    <div style={{ display:"flex", gap:12 }}>
                      {["Morning","Evening"].map(t => {
                        const c    = SLOT_STYLE[t];
                        const taken = isSlotTaken(form.date, t);
                        const sel   = form.time === t;
                        const booker = taken ? getSlotBooking(form.date, t) : null;
                        return (
                          <button key={t} className="slot-btn"
                            onClick={() => handleSlotSelect(t)}
                            disabled={taken}
                            style={{
                              borderColor: taken?"#fca5a5":sel?c.color:"rgba(59,130,246,0.25)",
                              background:  taken?"#fee2e2":sel?c.bg:"rgba(239,246,255,0.5)",
                              color: taken?"#dc2626":sel?c.color:"#374151",
                              opacity: taken?0.7:1 }}>
                            {sel && !taken && (
                              <div style={{ position:"absolute", top:8, right:8, width:20, height:20,
                                borderRadius:"50%", background:c.color, display:"flex",
                                alignItems:"center", justifyContent:"center", fontSize:11,
                                fontWeight:900, color:"#fff" }}>‚úì</div>
                            )}
                            <div style={{ fontSize:28, marginBottom:8 }}>{c.icon}</div>
                            <div style={{ fontFamily:"'Cinzel',serif", fontWeight:700, fontSize:13 }}>
                              {t} Prayer
                            </div>
                            {pt && !taken && (
                              <div style={{ fontSize:12, marginTop:6, fontWeight:700, color:c.color }}>
                                {pt[t]}
                              </div>
                            )}
                            {taken && booker && (
                              <div style={{ fontSize:10, marginTop:6, color:"#dc2626", fontWeight:600 }}>
                                üö´ Booked by {booker.name}
                              </div>
                            )}
                            <div style={{ fontSize:11, marginTop:8, fontWeight:600,
                              color:taken?"#dc2626":sel?"#16a34a":"rgba(30,64,175,0.4)" }}>
                              {taken?"üö´ Already Booked":sel?"‚úì Selected":"Tap to select"}
                            </div>
                          </button>
                        );
                      })}
                    </div>
                  </div>
                );
              })() : (
                <div style={{ textAlign:"center", padding:"12px 0", ...mutedBlue, fontSize:13 }}>
                  ‚òùÔ∏è Select a date to continue
                </div>
              )}

              {/* Prayer time info box */}
              {form.date && prayerTimes && form.time && (
                <div className="fade-in" style={{ background:"rgba(239,246,255,0.9)",
                  border:"1px solid rgba(59,130,246,0.25)", borderRadius:14, padding:"14px 16px" }}>
                  <div style={{ fontFamily:"'Cinzel',serif", ...blueText, fontSize:13,
                    fontWeight:700, marginBottom:10 }}>üïê Prayer Times for {formatDateWithDay(form.date)}</div>
                  <div style={{ display:"flex", gap:12 }}>
                    {["Morning","Evening"].map(t => {
                      const c = SLOT_STYLE[t];
                      return (
                        <div key={t} style={{ flex:1, borderRadius:10, padding:"12px",
                          background:c.bg, border:`1px solid ${c.border}`, textAlign:"center" }}>
                          <div style={{ fontSize:20, marginBottom:4 }}>{c.icon}</div>
                          <div style={{ fontSize:11, color:c.color, fontWeight:700 }}>{t}</div>
                          <div style={{ fontSize:14, fontWeight:900, color:c.color, marginTop:4 }}>
                            {prayerTimes[t]}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}

              {error && (
                <div className={`fade-in ${shake?"shake":""}`}
                  style={{ padding:"14px 18px", borderRadius:12, fontSize:13,
                    lineHeight:1.7, whiteSpace:"pre-line",
                    background:"#fee2e2", border:"1.5px solid #fca5a5", color:"#b91c1c" }}>
                  {error}
                </div>
              )}

              <div style={{ marginTop:8 }}>
                <button className="submit-btn" onClick={handleBook} disabled={submitting}>
                  {submitting ? "‚è≥ Saving..." : "üôè  Confirm Booking"}
                </button>
              </div>

            </div>
          )}

          {/* ‚ïê‚ïê SATSANG FORM ‚ïê‚ïê */}
          {dataReady && feat.satsangBooking && bookMode === "satsang" && (
            <div style={{ display:"flex", flexDirection:"column", gap:13 }}>

              <div style={{ textAlign:"center", marginBottom:4 }}>
                <div style={{ fontFamily:"'Cinzel',serif", color:"#78350f", fontSize:16, fontWeight:700 }}>
                  Book a Satsang Gathering
                </div>
                <div style={{ height:1, background:"linear-gradient(90deg,transparent,rgba(217,119,6,0.5),transparent)", marginTop:10 }}/>
              </div>

              {satsangError && (
                <div className={satsangShake?"shake":""} style={{ padding:"11px 14px", borderRadius:10,
                  fontSize:13, fontWeight:600, background:"#fef3c7", color:"#92400e", whiteSpace:"pre-line" }}>
                  {satsangError}
                </div>
              )}



              <div>
                <label className="divine-label" style={{ color:"rgba(120,53,15,0.7)" }}>üë§ Host Name</label>
                <input className="divine-input" placeholder="Name of the person hosting"
                  value={satsangForm.name}
                  style={{ borderColor:"rgba(217,119,6,0.3)" }}
                  onChange={e=>{setSatsangError("");setSatsangForm({...satsangForm,name:e.target.value})}}/>
              </div>
              <div>
                <label className="divine-label" style={{ color:"rgba(120,53,15,0.7)" }}>üì± Mobile Number</label>
                <input className="divine-input" placeholder="10-digit mobile" type="tel" maxLength={10}
                  value={satsangForm.mobile}
                  style={{ borderColor:"rgba(217,119,6,0.3)" }}
                  onChange={e=>{setSatsangError("");setSatsangForm({...satsangForm,mobile:e.target.value.replace(/[^0-9]/g,"")})}}/>
              </div>
              <div>
                <label className="divine-label" style={{ color:"rgba(120,53,15,0.7)" }}>üìÖ Date</label>
                <input type="date" className="divine-input" value={satsangForm.date} min={getTodayStr()}
                  style={{ fontSize:13, width:"100%", cursor:"pointer", borderColor:"rgba(217,119,6,0.3)" }}
                  onChange={e=>{setSatsangError("");setSatsangForm({...satsangForm,date:e.target.value})}}/>
              </div>
              <div>
                <label className="divine-label" style={{ color:"rgba(120,53,15,0.7)" }}>‚è∞ Time</label>
                <input className="divine-input" placeholder="e.g. 4:30 PM onwards"
                  value={satsangForm.time}
                  style={{ borderColor:"rgba(217,119,6,0.3)" }}
                  onChange={e=>setSatsangForm({...satsangForm,time:e.target.value})}/>
              </div>
              <div>
                <label className="divine-label" style={{ color:"rgba(120,53,15,0.7)" }}>üìç Venue / Address</label>
                <input className="divine-input" placeholder="Full address of the Satsang venue"
                  value={satsangForm.venue}
                  style={{ borderColor:"rgba(217,119,6,0.3)" }}
                  onChange={e=>setSatsangForm({...satsangForm,venue:e.target.value})}/>
              </div>
              <div>
                <label className="divine-label" style={{ color:"rgba(120,53,15,0.7)" }}>üìå Google Maps Link (optional)</label>
                <input className="divine-input" placeholder="Paste Google Maps link"
                  value={satsangForm.mapsLink}
                  style={{ borderColor:"rgba(217,119,6,0.3)" }}
                  onChange={e=>setSatsangForm({...satsangForm,mapsLink:e.target.value})}/>
              </div>
              <div>
                <label className="divine-label" style={{ color:"rgba(120,53,15,0.7)" }}>üôè Hosted By (optional)</label>
                <input className="divine-input" placeholder="e.g. Bannerghatta SUK"
                  value={satsangForm.hostedBy}
                  style={{ borderColor:"rgba(217,119,6,0.3)" }}
                  onChange={e=>setSatsangForm({...satsangForm,hostedBy:e.target.value})}/>
              </div>
              <div style={{ marginTop:8 }}>
                <button onClick={handleSatsangSubmit} disabled={satsangSubmitting}
                  style={{ width:"100%", padding:"15px", border:"none", borderRadius:13,
                    background:"linear-gradient(135deg,#78350f 0%,#d97706 50%,#fbbf24 100%)",
                    color:"#fff", fontWeight:900, fontSize:16, cursor:"pointer",
                    fontFamily:"'Cinzel',serif", letterSpacing:"0.5px",
                    boxShadow:"0 5px 22px rgba(120,53,15,0.35)",
                    opacity:satsangSubmitting?0.7:1, transition:"all 0.3s" }}>
                  {satsangSubmitting ? "‚è≥ Booking..." : "ü™î  Book This Satsang"}
                </button>
              </div>

            </div>
          )}

          {/* ‚îÄ‚îÄ Inline Cancel Section ‚îÄ‚îÄ */}
          {feat.cancelBooking && (<div style={{ marginTop:20 }}>
            <button
              onClick={() => { setShowCancel(!showCancel); setCancelMsg(""); setCancelResults(null); setCancelMobile(""); }}
              style={{ width:"100%", padding:"11px", border:"1px solid rgba(220,38,38,0.3)",
                borderRadius:11, background: showCancel ? "#fee2e2" : "rgba(254,242,242,0.6)",
                color:"#b91c1c", fontWeight:700, fontSize:13, cursor:"pointer",
                display:"flex", alignItems:"center", justifyContent:"center", gap:8, transition:"all 0.2s" }}>
              <span>{showCancel ? "‚ñ≤" : "‚ñº"}</span>
              Need to cancel a booking?
            </button>

            {showCancel && (
              <div className="fade-in" style={{ marginTop:12, padding:"18px", borderRadius:14,
                background:"rgba(254,242,242,0.8)", border:"1px solid rgba(220,38,38,0.2)" }}>
                <div style={{ fontFamily:"'Cinzel',serif", color:"#991b1b", fontSize:14,
                  fontWeight:700, marginBottom:14, textAlign:"center" }}>
                  Cancel Your Booking
                </div>

                <label className="divine-label" style={{ color:"rgba(153,27,27,0.7)" }}>üì± Mobile Number Used During Booking</label>
                <div style={{ display:"flex", gap:8 }}>
                  <input className="divine-input"
                    placeholder="Enter 10-digit number"
                    type="tel" maxLength="10"
                    value={cancelMobile}
                    style={{ borderColor:"rgba(220,38,38,0.3)", background:"#fff" }}
                    onChange={e => { setCancelMsg(""); setCancelResults(null); setCancelMobile(e.target.value.replace(/[^0-9]/g,"")); }} />
                  <button onClick={handleCancelLookup}
                    style={{ padding:"12px 16px", border:"none", borderRadius:10,
                      background:"#b91c1c", color:"#fff", fontWeight:700, fontSize:13,
                      cursor:"pointer", whiteSpace:"nowrap", flexShrink:0 }}>
                    üîç Find
                  </button>
                </div>

                {cancelMsg && (
                  <div style={{ marginTop:10, padding:"10px 14px", borderRadius:9, fontSize:12,
                    background: cancelMsg.startsWith("‚úÖ") ? "#d1fae5" : "#fee2e2",
                    border:`1px solid ${cancelMsg.startsWith("‚úÖ") ? "#6ee7b7":"#fca5a5"}`,
                    color: cancelMsg.startsWith("‚úÖ") ? "#065f46":"#b91c1c" }}>
                    {cancelMsg}
                  </div>
                )}

                {cancelResults && cancelResults.length > 0 && (
                  <div style={{ marginTop:12, display:"flex", flexDirection:"column", gap:8 }}>
                    {cancelResults.map(b => {
                      const isSatsang = b._type === "satsang";
                      if (isSatsang) {
                        // ‚îÄ‚îÄ SATSANG cancel card ‚îÄ‚îÄ
                        return (
                          <div key={b.id} style={{ background:"#fffbeb", borderRadius:12,
                            padding:"14px", border:"1px solid rgba(217,119,6,0.25)" }}>
                            <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:8 }}>
                              <div>
                                <div style={{ marginBottom:2 }}>
                                  <span style={{ fontSize:10, fontWeight:800, color:"#92400e",
                                    background:"rgba(217,119,6,0.12)", padding:"2px 7px",
                                    borderRadius:10, textTransform:"uppercase", letterSpacing:"0.5px" }}>ü™î Satsang</span>
                                </div>
                                <div style={{ fontFamily:"'Cinzel',serif", fontWeight:800, color:"#78350f", fontSize:13 }}>
                                  {b.name}
                                </div>
                                <div style={{ fontSize:12, color:"#d97706", fontWeight:700, marginTop:2 }}>
                                  üìÖ {formatDateWithDay(b.date)} ¬∑ ‚è∞ {b.time}
                                </div>
                                {b.venue && <div style={{ fontSize:11, color:"#6b7280", marginTop:2 }}>üìç {b.venue}</div>}
                              </div>
                
                            </div>
                            <button
                              disabled={cancelling === b.id}
                              onClick={() => handleCancelSatsang(b.id)}
                              style={{ width:"100%", padding:"9px", border:"none", borderRadius:9,
                                background:"linear-gradient(135deg,#92400e,#d97706)",
                                color:"#fff", fontWeight:700, fontSize:13, cursor:"pointer",
                                opacity:cancelling === b.id ? 0.6 : 1 }}>
                              {cancelling === b.id ? "‚è≥ Cancelling..." : "üóëÔ∏è  Cancel This Satsang"}
                            </button>
                          </div>
                        );
                      }
                      // ‚îÄ‚îÄ PRAYER cancel card ‚îÄ‚îÄ
                      const c = SLOT_STYLE[b.time] || SLOT_STYLE["Morning"];
                      return (
                        <div key={b.id} style={{ background:"#fff", borderRadius:12,
                          padding:"14px", border:"1px solid rgba(220,38,38,0.2)" }}>
                          <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:8 }}>
                            <div>
                              <div style={{ marginBottom:2 }}>
                                <span style={{ fontSize:10, fontWeight:800, color:"#1d4ed8",
                                  background:"rgba(29,78,216,0.08)", padding:"2px 7px",
                                  borderRadius:10, textTransform:"uppercase", letterSpacing:"0.5px" }}>üôè Prayer</span>
                              </div>
                              <div style={{ fontFamily:"'Cinzel',serif", fontWeight:800, color:"#1e3a8a", fontSize:13 }}>
                                {b.name}
                              </div>
                              <div style={{ fontSize:12, color:c.color, fontWeight:700, marginTop:2 }}>
                                {c.icon} {b.time} Prayer ¬∑ {formatDateWithDay(b.date)}
                              </div>
                              {b.prayerTime && (
                                <div style={{ fontSize:11, color:"#6b7280", marginTop:2 }}>üïê {cleanTime(b.prayerTime)}</div>
                              )}
                            </div>

                          </div>
                          <button
                            disabled={cancelling === b.id}
                            onClick={() => handleCancelBooking(b.id)}
                            style={{ width:"100%", padding:"9px", border:"none", borderRadius:9,
                              background:"linear-gradient(135deg,#dc2626,#ef4444)",
                              color:"#fff", fontWeight:700, fontSize:13, cursor:"pointer",
                              opacity:cancelling === b.id ? 0.6 : 1 }}>
                            {cancelling === b.id ? "‚è≥ Cancelling..." : "üóëÔ∏è  Cancel This Booking"}
                          </button>
                        </div>
                      );
                    })}
                  </div>
                )}

                {cancelResults && cancelResults.length === 0 && (
                  <div style={{ textAlign:"center", padding:"16px 0", color:"rgba(153,27,27,0.5)", fontSize:13 }}>
                    No bookings found for this number.
                  </div>
                )}
              </div>
            )}
          </div>)}
        </div>

      )}

      {activeTab === "manage" && manageTab === "times" && (
        <div className="card">
          <div style={{ textAlign:"center", marginBottom:20 }}>
            <div style={{ fontFamily:"'Cinzel', serif", ...blueText, fontSize:17, fontWeight:700 }}>
              Bangalore Urban, Karnataka
            </div>
            <div style={{ ...mutedBlue, fontSize:11, marginTop:4, letterSpacing:"1px" }}>
              Annual Prayer Timetable ¬∑ satsang.org.in
            </div>
            <BlueDivider />
          </div>

          {/* Current month */}
          {(() => {
            const m  = new Date().getMonth() + 1;
            const pt = PRAYER_TIMES[m];
            return (
              <div style={{ background:"#eff6ff", border:"1px solid rgba(59,130,246,0.3)",
                borderRadius:16, padding:"20px", marginBottom:20, textAlign:"center" }}>
                <div style={{ ...mutedBlue, fontSize:11, fontWeight:700, textTransform:"uppercase",
                  letterSpacing:"1.5px", marginBottom:14 }}>
                  ‚≠ê {MONTH_NAMES[m]} ‚Äî Current Month
                </div>
                <div style={{ display:"flex", justifyContent:"center", gap:32 }}>
                  <div>
                    <div style={{ fontSize:12, color:"#d97706", fontWeight:700, marginBottom:6 }}>üåÖ Morning</div>
                    <div style={{ fontFamily:"'Cinzel', serif", fontSize:28, fontWeight:900, color:"#d97706" }}>{pt.Morning}</div>
                  </div>
                  <div style={{ width:1, background:"rgba(59,130,246,0.2)" }}/>
                  <div>
                    <div style={{ fontSize:12, color:"#7c3aed", fontWeight:700, marginBottom:6 }}>üåô Evening</div>
                    <div style={{ fontFamily:"'Cinzel', serif", fontSize:28, fontWeight:900, color:"#7c3aed" }}>{pt.Evening}</div>
                  </div>
                </div>
              </div>
            );
          })()}

          {/* Full year table */}
          <div style={{ borderRadius:12, overflow:"hidden", border:"1px solid rgba(59,130,246,0.15)" }}>
            <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr 1fr",
              background:"rgba(29,78,216,0.9)", padding:"10px 16px" }}>
              <div style={{ fontSize:10, fontWeight:700, color:"rgba(255,255,255,0.8)", textTransform:"uppercase", letterSpacing:"1px" }}>Month</div>
              <div style={{ fontSize:10, fontWeight:700, color:"#fde68a", textTransform:"uppercase", letterSpacing:"1px", textAlign:"center" }}>üåÖ Morning</div>
              <div style={{ fontSize:10, fontWeight:700, color:"#c4b5fd", textTransform:"uppercase", letterSpacing:"1px", textAlign:"center" }}>üåô Evening</div>
            </div>
            {Object.entries(PRAYER_TIMES).map(([month, times]) => {
              const isCurrent = parseInt(month) === new Date().getMonth() + 1;
              return (
                <div key={month} style={{
                  display:"grid", gridTemplateColumns:"1fr 1fr 1fr",
                  padding:"11px 16px",
                  background: isCurrent ? "#dbeafe" : parseInt(month)%2===0 ? "#f8faff" : "#fff",
                  borderBottom:"1px solid rgba(59,130,246,0.08)"
                }}>
                  <div style={{ fontSize:13, fontWeight: isCurrent ? 800 : 500,
                    color: isCurrent ? "#1d4ed8" : "#6b7280" }}>
                    {isCurrent ? "‚≠ê " : ""}{MONTH_NAMES[month]}
                  </div>
                  <div style={{ fontSize:14, fontWeight:700, color:"#d97706", textAlign:"center" }}>{times.Morning}</div>
                  <div style={{ fontSize:14, fontWeight:700, color:"#7c3aed", textAlign:"center" }}>{times.Evening}</div>
                </div>
              );
            })}
          </div>
          <p style={{ fontSize:11, color:"rgba(59,130,246,0.4)", marginTop:14, textAlign:"center", lineHeight:1.6 }}>
            Fixed monthly times ¬∑ Same every year ¬∑ Source: satsang.org.in
          </p>
        </div>
      )}

      {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RETRIEVE & SHARE TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
      {activeTab === "manage" && manageTab === "share" && (
        <div className="card">
          <div style={{ textAlign:"center", marginBottom:20 }}>
            <div style={{ fontFamily:"'Cinzel',serif", ...blueText, fontSize:17, fontWeight:700 }}>
              Retrieve Booking Details
            </div>
            <div style={{ ...mutedBlue, fontSize:12, marginTop:4 }}>
              Enter your mobile number to find and share your booking
            </div>
            <div className="blue-line" style={{ marginTop:10 }}/>
          </div>

          <div style={{ display:"flex", flexDirection:"column", gap:14 }}>
            <div>
              <label className="divine-label">üì± Your Mobile Number</label>
              <div style={{ display:"flex", gap:8 }}>
                <input className="divine-input"
                  placeholder="Enter 10-digit mobile number"
                  type="tel" maxLength="10"
                  value={shareMobile}
                  onChange={e => { setShareMsg(""); setShareResults(null); setShareMobile(e.target.value.replace(/[^0-9]/g,"")); }}
                  style={{ flex:1 }} />
                <button onClick={handleShareLookup}
                  style={{ padding:"12px 16px", border:"none", borderRadius:10,
                    background:"linear-gradient(135deg,#1d4ed8,#3b82f6)",
                    color:"#fff", fontWeight:700, fontSize:13,
                    cursor:"pointer", whiteSpace:"nowrap", flexShrink:0,
                    boxShadow:"0 3px 10px rgba(29,78,216,0.3)" }}>
                  üîç Find
                </button>
              </div>
            </div>
          </div>

          {/* Message */}
          {shareMsg && (
            <div style={{ marginTop:12, padding:"10px 14px", borderRadius:9, fontSize:13,
              background: shareMsg.startsWith("‚ö†Ô∏è") ? "#fef3c7" : "#fee2e2",
              border:`1px solid ${shareMsg.startsWith("‚ö†Ô∏è") ? "#fcd34d":"#fca5a5"}`,
              color: shareMsg.startsWith("‚ö†Ô∏è") ? "#92400e":"#b91c1c" }}>
              {shareMsg}
            </div>
          )}

          {/* Results ‚Äî prayer + satsang combined */}
          {shareResults && shareResults.length > 0 && (
            <div style={{ marginTop:18 }}>
              <div style={{ fontSize:12, color:"rgba(29,78,216,0.6)", fontWeight:700,
                textTransform:"uppercase", letterSpacing:"1px", marginBottom:12 }}>
                {shareResults.length} Booking{shareResults.length > 1 ? "s" : ""} Found
                <span style={{ fontSize:11, color:"rgba(29,78,216,0.4)", fontWeight:400,
                  marginLeft:8, textTransform:"none" }}>
                  ({shareResults.filter(b=>b._type==="prayer").length} Prayer ¬∑{" "}
                   {shareResults.filter(b=>b._type==="satsang").length} Satsang)
                </span>
              </div>
              <div style={{ display:"flex", flexDirection:"column", gap:14 }}>
                {shareResults.map(b => {
                  const isSatsang = b._type === "satsang";

                  /* ‚îÄ‚îÄ PRAYER CARD ‚îÄ‚îÄ */
                  if (!isSatsang) {
                    const sc = SLOT_STYLE[b.time] || SLOT_STYLE["Morning"];
                    const shareConf = { name:b.name, mobile:b.mobile, time:b.time,
                      date:b.date, prayerTime:cleanTime(b.prayerTime), place:b.place, id:b.id };
                    return (
                      <div key={b.id} style={{ border:"1.5px solid rgba(59,130,246,0.2)",
                        borderRadius:16, overflow:"hidden",
                        background:"rgba(239,246,255,0.5)" }}>
                        {/* Blue top bar */}
                        <div style={{ height:4, background:"linear-gradient(90deg,#1d4ed8,#3b82f6,#60a5fa)" }}/>
                        <div style={{ padding:"14px 16px" }}>
                          {/* Type badge + ID */}
                          <div style={{ marginBottom:10 }}>
                            <span style={{ fontSize:10, fontWeight:800, color:"#1d4ed8",
                              background:"rgba(29,78,216,0.1)", padding:"3px 9px",
                              borderRadius:20, letterSpacing:"1px", textTransform:"uppercase" }}>
                              üåÖ Prayer Booking
                            </span>
                          </div>
                          {/* Details */}
                          <div style={{ fontFamily:"'Cinzel',serif", fontWeight:800,
                            color:"#1e3a8a", fontSize:14, marginBottom:4 }}>{b.name}</div>
                          <div style={{ fontSize:13, color:sc.color, fontWeight:700 }}>
                            {sc.icon} {b.time} Prayer ¬∑ {formatDateWithDay(b.date)}
                          </div>
                          <div style={{ fontSize:12, color:"#6b7280", marginTop:3 }}>
                            üïê {cleanTime(b.prayerTime)}
                            {b.place && (b.place.startsWith("http") ? (
                              <a href={b.place} target="_blank" rel="noopener noreferrer"
                                style={{ marginLeft:6, color:"#1d4ed8", fontWeight:700, textDecoration:"none" }}>
                                üìç View Map
                              </a>
                            ) : ` ¬∑ ${b.place}`)}</div>

                          {/* Address edit */}
                          <div style={{ margin:"10px 0 0", padding:"10px 12px", borderRadius:10,
                            background:"rgba(239,246,255,0.8)", border:"1px solid rgba(59,130,246,0.15)" }}>
                            <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:6 }}>
                              <span style={{ fontSize:11, fontWeight:700, color:"rgba(29,78,216,0.6)",
                                textTransform:"uppercase", letterSpacing:"1px" }}>üìç Address</span>
                              {editingAddress !== b.id && (
                                <button onClick={() => { setEditingAddress(b.id); setEditAddressVal(b.place||""); }}
                                  style={{ fontSize:11, fontWeight:700, color:"#1d4ed8", background:"none",
                                    border:"1px solid rgba(29,78,216,0.3)", borderRadius:6,
                                    padding:"3px 8px", cursor:"pointer" }}>‚úèÔ∏è Edit</button>
                              )}
                            </div>
                            {editingAddress !== b.id && (
                              <div style={{ fontSize:12, color:"#374151" }}>
                                {b.place && b.place.startsWith("http") ? (
                                  <a href={b.place} target="_blank" rel="noopener noreferrer"
                                    style={{ color:"#1d4ed8", fontWeight:600, textDecoration:"none" }}>üìç View on Map</a>
                                ) : (
                                  <span>{b.place || <span style={{color:"#9ca3af",fontStyle:"italic"}}>No address set</span>}</span>
                                )}
                              </div>
                            )}
                            {editingAddress === b.id && (
                              <div style={{ display:"flex", flexDirection:"column", gap:8, marginTop:4 }}>
                                <input className="divine-input" placeholder="Address or Google Maps link"
                                  value={editAddressVal} onChange={e=>setEditAddressVal(e.target.value)}
                                  style={{ fontSize:12, padding:"9px 12px" }} autoFocus/>
                                <div style={{ display:"flex", gap:8 }}>
                                  <button disabled={savingAddress||!editAddressVal.trim()}
                                    onClick={() => handleUpdateAddress(b.id, editAddressVal.trim())}
                                    style={{ flex:1, padding:"9px", border:"none", borderRadius:8,
                                      background:"linear-gradient(135deg,#1d4ed8,#3b82f6)",
                                      color:"#fff", fontWeight:700, fontSize:12, cursor:"pointer",
                                      opacity:(savingAddress||!editAddressVal.trim())?0.6:1 }}>
                                    {savingAddress ? "‚è≥ Saving..." : "‚úÖ Save"}
                                  </button>
                                  <button onClick={()=>setEditingAddress(null)}
                                    style={{ padding:"9px 14px", border:"1px solid rgba(30,64,175,0.2)",
                                      borderRadius:8, background:"#fff", color:"#6b7280",
                                      fontWeight:600, fontSize:12, cursor:"pointer" }}>Cancel</button>
                                </div>
                              </div>
                            )}
                            {addressMsg[b.id] && (
                              <div style={{ marginTop:6, fontSize:12, fontWeight:600,
                                color:addressMsg[b.id].startsWith("‚úÖ")?"#065f46":"#b91c1c" }}>
                                {addressMsg[b.id]}
                              </div>
                            )}
                          </div>

                          <div style={{ height:1, background:"rgba(59,130,246,0.12)", margin:"12px 0 10px" }}/>

                          {/* Share buttons */}
                          <div style={{ fontSize:11, fontWeight:700, color:"rgba(29,78,216,0.5)",
                            textTransform:"uppercase", letterSpacing:"1px", marginBottom:8 }}>üì§ Share Booking</div>
                          <div style={{ display:"flex", flexDirection:"column", gap:7 }}>
                            <a href={`https://wa.me/?text=${buildShareMsg(shareConf)}`}
                              target="_blank" rel="noopener noreferrer"
                              style={{ display:"flex", alignItems:"center", justifyContent:"center",
                                gap:8, padding:"11px", borderRadius:10, textDecoration:"none",
                                background:"linear-gradient(135deg,#25D366,#128C7E)",
                                color:"#fff", fontWeight:800, fontSize:13 }}>
                              üí¨ Share on WhatsApp
                            </a>
                            <a href={`sms:${b.mobile}?body=${buildShareMsg(shareConf)}`}
                              style={{ display:"flex", alignItems:"center", justifyContent:"center",
                                gap:8, padding:"11px", borderRadius:10, textDecoration:"none",
                                background:"linear-gradient(135deg,#1d4ed8,#3b82f6)",
                                color:"#fff", fontWeight:800, fontSize:13 }}>
                              üì± Send as SMS
                            </a>
                            <button onClick={()=>handleCopy(shareConf)}
                              style={{ display:"flex", alignItems:"center", justifyContent:"center",
                                gap:8, padding:"11px", borderRadius:10, border:"none",
                                background:"rgba(30,64,175,0.08)", cursor:"pointer",
                                color:"#1e3a8a", fontWeight:700, fontSize:13 }}>
                              üìã Copy Message
                            </button>
                          </div>

                          {/* Cancel prayer */}
                          <div style={{ marginTop:10 }}>
                            <button
                              disabled={cancelling === b.id}
                              onClick={() => handleCancelBooking(b.id)}
                              style={{ width:"100%", padding:"10px", border:"1px solid rgba(220,38,38,0.3)",
                                borderRadius:10, background:"rgba(254,242,242,0.8)",
                                color:"#b91c1c", fontWeight:700, fontSize:12, cursor:"pointer",
                                opacity: cancelling===b.id ? 0.6 : 1 }}>
                              {cancelling===b.id ? "‚è≥ Cancelling..." : "‚ùå Cancel This Booking"}
                            </button>
                          </div>
                        </div>
                      </div>
                    );
                  }

                  /* ‚îÄ‚îÄ SATSANG CARD ‚îÄ‚îÄ */
                  const satsangShareConf = { ...b };
                  return (
                    <div key={b.id} style={{ border:"1.5px solid rgba(217,119,6,0.25)",
                      borderRadius:16, overflow:"hidden",
                      background:"rgba(255,251,235,0.6)" }}>
                      {/* Amber top bar */}
                      <div style={{ height:4, background:"linear-gradient(90deg,#78350f,#d97706,#fbbf24)" }}/>
                      <div style={{ padding:"14px 16px" }}>
                        {/* Type badge + ID */}
                        <div style={{ marginBottom:10 }}>
                          <span style={{ fontSize:10, fontWeight:800, color:"#92400e",
                            background:"rgba(217,119,6,0.12)", padding:"3px 9px",
                            borderRadius:20, letterSpacing:"1px", textTransform:"uppercase" }}>
                            ü™î Satsang Booking
                          </span>
                        </div>
                        {/* Details */}
                        <div style={{ fontFamily:"'Cinzel',serif", fontWeight:800,
                          color:"#78350f", fontSize:14, marginBottom:4 }}>{b.name}</div>
                        <div style={{ fontSize:13, color:"#d97706", fontWeight:700 }}>
                          üìÖ {b.day ? b.day+", " : ""}{formatDate ? formatDate(b.date) : b.date}
                        </div>
                        <div style={{ fontSize:12, color:"#6b7280", marginTop:3 }}>
                          ‚è∞ {cleanTime(b.time)} onwards
                          {b.venue && ` ¬∑ üìç ${b.venue}`}
                        </div>
                        {b.mapsLink && (
                          <a href={b.mapsLink} target="_blank" rel="noopener noreferrer"
                            style={{ fontSize:12, color:"#d97706", fontWeight:600,
                              textDecoration:"none", display:"block", marginTop:3 }}>
                            üó∫Ô∏è View on Map
                          </a>
                        )}
                        {b.hostedBy && (
                          <div style={{ fontSize:12, color:"#92400e", marginTop:3, fontWeight:600 }}>
                            üôè {b.hostedBy}
                          </div>
                        )}

                        <div style={{ height:1, background:"rgba(217,119,6,0.15)", margin:"12px 0 10px" }}/>

                        {/* Share buttons (amber theme) */}
                        <div style={{ fontSize:11, fontWeight:700, color:"rgba(120,53,15,0.6)",
                          textTransform:"uppercase", letterSpacing:"1px", marginBottom:8 }}>üì§ Share Satsang</div>
                        <div style={{ display:"flex", flexDirection:"column", gap:7 }}>
                          <a href={`https://wa.me/?text=${buildSatsangShareMsg(satsangShareConf)}`}
                            target="_blank" rel="noopener noreferrer"
                            style={{ display:"flex", alignItems:"center", justifyContent:"center",
                              gap:8, padding:"11px", borderRadius:10, textDecoration:"none",
                              background:"linear-gradient(135deg,#25D366,#128C7E)",
                              color:"#fff", fontWeight:800, fontSize:13 }}>
                            üí¨ Share on WhatsApp
                          </a>
                          <a href={`sms:?body=${buildSatsangShareMsg(satsangShareConf)}`}
                            style={{ display:"flex", alignItems:"center", justifyContent:"center",
                              gap:8, padding:"11px", borderRadius:10, textDecoration:"none",
                              background:"linear-gradient(135deg,#d97706,#fbbf24)",
                              color:"#fff", fontWeight:800, fontSize:13 }}>
                            üì± Send as SMS
                          </a>
                          <button onClick={()=>handleSatsangCopy(satsangShareConf)}
                            style={{ display:"flex", alignItems:"center", justifyContent:"center",
                              gap:8, padding:"11px", borderRadius:10, border:"none",
                              background:"rgba(120,53,15,0.08)", cursor:"pointer",
                              color:"#78350f", fontWeight:700, fontSize:13 }}>
                            üìã Copy Message
                          </button>
                        </div>

                        {/* Cancel satsang */}
                        <div style={{ marginTop:10 }}>
                          <button
                            disabled={cancelling === b.id}
                            onClick={() => handleCancelSatsang(b.id)}
                            style={{ width:"100%", padding:"10px", border:"1px solid rgba(217,119,6,0.3)",
                              borderRadius:10, background:"rgba(255,251,235,0.9)",
                              color:"#92400e", fontWeight:700, fontSize:12, cursor:"pointer",
                              opacity: cancelling===b.id ? 0.6 : 1 }}>
                            {cancelling===b.id ? "‚è≥ Cancelling..." : "‚ùå Cancel This Satsang"}
                          </button>
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          )}

          {shareResults && shareResults.length === 0 && !shareMsg && (
            <div style={{ textAlign:"center", padding:"24px 0",
              color:"rgba(29,78,216,0.4)", fontSize:13 }}>
              No bookings found for this number.
            </div>
          )}
        </div>
      )}



      {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ALL BOOKINGS ‚Äî LIST VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
      {activeTab === "manage" && manageTab === "all" && (() => {
        const todayStr = getTodayStr();

        const AllBookingsView = () => {
          const nowYM = todayStr.slice(0, 7); // "YYYY-MM"
          const [activeYM,  setActiveYM]  = React.useState(nowYM);
          const [typeTab,   setTypeTab]   = React.useState("all"); // all|prayer|satsang
          const [search,    setSearch]    = React.useState("");

          const allItems = [
            ...bookings.map(b       => ({ ...b, _type:"prayer"  })),
            ...satsangBookings.map(b => ({ ...b, _type:"satsang" })),
          ];

          // All YYYY-MM months that have data, sorted asc
          const allMonths = React.useMemo(() => {
            const seen = new Set(allItems.map(b => (b.date||"").slice(0,7)).filter(Boolean));
            // always include current month even if empty
            seen.add(nowYM);
            return Array.from(seen).sort();
          }, [bookings, satsangBookings]);

          const monthIdx = allMonths.indexOf(activeYM);

          const goPrev = () => { if (monthIdx > 0) setActiveYM(allMonths[monthIdx - 1]); };
          const goNext = () => { if (monthIdx < allMonths.length - 1) setActiveYM(allMonths[monthIdx + 1]); };

          const monthLabel = new Date(activeYM + "-01T00:00:00")
            .toLocaleDateString("en-IN", { month:"long", year:"numeric" });

          const isSearching = search.trim().length > 0;

          // When searching ‚Äî spans ALL months; otherwise current month only
          const filtered = allItems.filter(b => {
            if (typeTab === "prayer"  && b._type !== "prayer")  return false;
            if (typeTab === "satsang" && b._type !== "satsang") return false;
            if (isSearching) {
              const q = search.toLowerCase();
              return (b.name||"").toLowerCase().includes(q)
                  || (b.venue||"").toLowerCase().includes(q)
                  || (b.hostedBy||"").toLowerCase().includes(q);
            }
            return (b.date||"").startsWith(activeYM);
          }).sort((a, b) => (a.date||"").localeCompare(b.date||""));

          // Group by date
          const groups = {};
          filtered.forEach(b => {
            const d = b.date || "Unknown";
            if (!groups[d]) groups[d] = [];
            groups[d].push(b);
          });
          const sortedDates = Object.keys(groups).sort();

          // Counts for type tabs
          const monthItems = allItems.filter(b => (b.date||"").startsWith(activeYM));
          const counts = {
            all:     monthItems.length,
            prayer:  monthItems.filter(b => b._type==="prayer").length,
            satsang: monthItems.filter(b => b._type==="satsang").length,
          };

          const TYPE_TABS = [
            { id:"all",     label:"All",     icon:"üìã" },
            { id:"prayer",  label:"Prayer",  icon:"üôè" },
            { id:"satsang", label:"Satsang", icon:"ü™î" },
          ];

          return (
            <div style={{ display:"flex", flexDirection:"column", gap:10 }}>

              {/* ‚îÄ‚îÄ Month navigator ‚îÄ‚îÄ */}
              <div className="card" style={{ padding:"14px 16px 14px" }}>

                {/* Row 1: < Month Year > ‚Äî hidden while searching */}
                {isSearching && (
                  <div style={{ display:"flex", alignItems:"center", gap:8,
                    marginBottom:12, padding:"8px 12px", borderRadius:10,
                    background:"rgba(29,78,216,0.07)",
                    border:"1px solid rgba(29,78,216,0.15)" }}>
                    <span style={{ fontSize:13 }}>üîç</span>
                    <span style={{ fontSize:12, color:"rgba(29,78,216,0.65)", fontWeight:700 }}>
                      Searching across all months
                    </span>
                  </div>
                )}
                {!isSearching && (
                <div style={{ display:"flex", alignItems:"center",
                  justifyContent:"space-between", marginBottom:14 }}>
                  <button onClick={goPrev} disabled={monthIdx <= 0}
                    style={{ width:36, height:36, borderRadius:"50%", border:"none",
                      cursor: monthIdx <= 0 ? "not-allowed" : "pointer",
                      background: monthIdx <= 0 ? "rgba(59,130,246,0.05)" : "rgba(29,78,216,0.1)",
                      color:  monthIdx <= 0 ? "rgba(29,78,216,0.2)" : "#1d4ed8",
                      fontSize:16, fontWeight:900, display:"flex",
                      alignItems:"center", justifyContent:"center",
                      transition:"all 0.15s" }}>‚Äπ</button>

                  <div style={{ textAlign:"center" }}>
                    <div style={{ fontFamily:"'Cinzel',serif", fontWeight:900,
                      color:"#1e3a8a", fontSize:16, letterSpacing:"0.3px" }}>
                      {monthLabel}
                    </div>
                    <div style={{ fontSize:11, color:"rgba(29,78,216,0.45)", marginTop:2 }}>
                      {counts.all} booking{counts.all!==1?"s":""} this month
                    </div>
                  </div>

                  <button onClick={goNext} disabled={monthIdx >= allMonths.length - 1}
                    style={{ width:36, height:36, borderRadius:"50%", border:"none",
                      cursor: monthIdx >= allMonths.length-1 ? "not-allowed" : "pointer",
                      background: monthIdx >= allMonths.length-1 ? "rgba(59,130,246,0.05)" : "rgba(29,78,216,0.1)",
                      color:  monthIdx >= allMonths.length-1 ? "rgba(29,78,216,0.2)" : "#1d4ed8",
                      fontSize:16, fontWeight:900, display:"flex",
                      alignItems:"center", justifyContent:"center",
                      transition:"all 0.15s" }}>‚Ä∫</button>
                </div>

                )}
                {/* Row 2: All | Prayer | Satsang tabs */}
                <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr 1fr",
                  gap:6, marginBottom:12 }}>
                  {TYPE_TABS.map(t => {
                    const active = typeTab === t.id;
                    return (
                      <button key={t.id} onClick={() => setTypeTab(t.id)}
                        style={{ padding:"9px 0", borderRadius:12, border:"none",
                          cursor:"pointer", fontFamily:"'Cinzel',serif",
                          fontSize:12, fontWeight:800, transition:"all 0.18s",
                          background: active
                            ? t.id==="satsang" ? "linear-gradient(135deg,#78350f,#d97706)"
                              : t.id==="prayer" ? "linear-gradient(135deg,#1d4ed8,#3b82f6)"
                              : "linear-gradient(135deg,#1e3a8a,#3b82f6)"
                            : "rgba(239,246,255,0.7)",
                          color: active ? "#fff" : "rgba(29,78,216,0.5)",
                          boxShadow: active ? "0 3px 12px rgba(29,78,216,0.2)" : "none",
                          border: active ? "none" : "1px solid rgba(59,130,246,0.15)" }}>
                        <div>{t.icon}</div>
                        <div style={{ fontSize:11 }}>{t.label}</div>
                        <div style={{ fontSize:10, marginTop:1,
                          opacity: active ? 0.85 : 0.55,
                          color: active ? "#fff" : "#1d4ed8",
                          fontFamily:"sans-serif", fontWeight:700 }}>
                          {counts[t.id]}
                        </div>
                      </button>
                    );
                  })}
                </div>

                {/* Row 3: Search */}
                <div style={{ position:"relative" }}>
                  <input className="divine-input"
                    placeholder="üîç  Search by name or venue..."
                    value={search} onChange={e => setSearch(e.target.value)}
                    style={{ paddingLeft:14, fontSize:13 }}
                  />
                  {search && (
                    <button onClick={() => setSearch("")}
                      style={{ position:"absolute", right:10, top:"50%",
                        transform:"translateY(-50%)", background:"none", border:"none",
                        cursor:"pointer", fontSize:15,
                        color:"rgba(29,78,216,0.4)", lineHeight:1 }}>‚úï</button>
                  )}
                </div>
              </div>

              {/* ‚îÄ‚îÄ Booking cards ‚îÄ‚îÄ */}
              {!dataReady ? (
                <div style={{ display:"flex", flexDirection:"column", gap:10 }}>
                  <SkeletonCard rows={3}/><SkeletonCard rows={3}/><SkeletonCard rows={2}/>
                </div>
              ) : filtered.length === 0 ? (
                <div className="card" style={{ textAlign:"center", padding:"40px 0" }}>
                  <div style={{ fontSize:36, marginBottom:10,
                    filter:"saturate(0) brightness(2.2)" }}>ü™∑</div>
                  <div style={{ color:"rgba(29,78,216,0.35)", fontSize:13 }}>
                    {isSearching
                      ? `No results for "${search}" across all months`
                      : `No ${typeTab==="all"?"bookings":typeTab+" bookings"} in ${monthLabel}`}
                  </div>
                  {search && (
                    <button onClick={() => setSearch("")}
                      style={{ marginTop:10, padding:"7px 16px", borderRadius:20,
                        border:"1px solid rgba(29,78,216,0.2)", background:"transparent",
                        color:"#1d4ed8", fontSize:12, fontWeight:700, cursor:"pointer" }}>
                      Clear search
                    </button>
                  )}
                </div>
              ) : (
                <div style={{ display:"flex", flexDirection:"column", gap:6 }}>
                  {sortedDates.map(date => {
                    const dayItems   = groups[date];
                    const isToday    = date === todayStr;
                    const isPast     = date < todayStr;
                    const dateLabel  = new Date(date+"T00:00:00")
                      .toLocaleDateString("en-IN",{
                        weekday:"short", day:"numeric", month:"short"
                      });

                    return (
                      <div key={date}>
                        {/* Date strip */}
                        <div style={{ display:"flex", alignItems:"center", gap:8,
                          margin:"10px 0 6px" }}>
                          <div style={{ padding:"3px 12px", borderRadius:20,
                            fontSize:11, fontWeight:800, whiteSpace:"nowrap",
                            background: isToday  ? "rgba(29,78,216,0.12)"
                              : isPast ? "rgba(107,114,128,0.09)"
                              : "rgba(16,185,129,0.09)",
                            border:`1px solid ${isToday ? "rgba(29,78,216,0.25)"
                              : isPast ? "rgba(107,114,128,0.18)" : "rgba(16,185,129,0.22)"}`,
                            color: isToday ? "#1d4ed8" : isPast ? "#6b7280" : "#065f46" }}>
                            {isToday ? "‚≠ê Today" : dateLabel}
                            <span style={{ marginLeft:5, opacity:0.6 }}>
                              ¬∑ {dayItems.length}
                            </span>
                          </div>
                          <div style={{ flex:1, height:1,
                            background:"linear-gradient(90deg,rgba(59,130,246,0.12),transparent)" }}/>
                        </div>

                        <div style={{ display:"flex", flexDirection:"column", gap:8 }}>
                          {dayItems.map(b => {
                            if (b._type === "prayer") {
                              const sc = SLOT_STYLE[b.time] || SLOT_STYLE["Morning"];
                              return (
                                <div key={b.id} style={{ borderRadius:14, overflow:"hidden",
                                  border:"1px solid rgba(59,130,246,0.18)",
                                  background:"rgba(239,246,255,0.65)" }}>
                                  <div style={{ height:3,
                                    background:`linear-gradient(90deg,${sc.color},${sc.color}55)` }}/>
                                  <div style={{ padding:"12px 14px" }}>
                                    <div style={{ display:"flex", justifyContent:"space-between",
                                      alignItems:"flex-start", gap:8, marginBottom:4 }}>
                                      <div style={{ fontFamily:"'Cinzel',serif", fontWeight:800,
                                        color:"#1e3a8a", fontSize:14 }}>{b.name}</div>
                                      <span style={{ flexShrink:0, fontSize:10, fontWeight:800,
                                        color:"#1d4ed8", background:"rgba(29,78,216,0.09)",
                                        padding:"2px 8px", borderRadius:20,
                                        textTransform:"uppercase", letterSpacing:"0.6px" }}>
                                        üôè Prayer
                                      </span>
                                    </div>
                                    <div style={{ fontSize:13, color:sc.color,
                                      fontWeight:700, marginBottom:3 }}>
                                      {sc.icon} {b.time} ¬∑ üïê {cleanTime(b.prayerTime)}
                                    </div>
                                    {b.place && (
                                      <div style={{ fontSize:12, color:"#6b7280" }}>
                                        {b.place.startsWith("http")
                                          ? <a href={b.place} target="_blank" rel="noopener noreferrer"
                                              style={{ color:"#1d4ed8", fontWeight:600, textDecoration:"none" }}>
                                              üìç View on Map</a>
                                          : <>üìç {b.place}</>}
                                      </div>
                                    )}
                                  </div>
                                </div>
                              );
                            }
                            // Satsang
                            return (
                              <div key={b.id} style={{ borderRadius:14, overflow:"hidden",
                                border:"1px solid rgba(217,119,6,0.2)",
                                background:"rgba(255,251,235,0.75)" }}>
                                <div style={{ height:3,
                                  background:"linear-gradient(90deg,#d97706,#fbbf2455)" }}/>
                                <div style={{ padding:"12px 14px" }}>
                                  <div style={{ display:"flex", justifyContent:"space-between",
                                    alignItems:"flex-start", gap:8, marginBottom:4 }}>
                                    <div style={{ fontFamily:"'Cinzel',serif", fontWeight:800,
                                      color:"#78350f", fontSize:14 }}>{b.name}</div>
                                    <span style={{ flexShrink:0, fontSize:10, fontWeight:800,
                                      color:"#92400e", background:"rgba(217,119,6,0.1)",
                                      padding:"2px 8px", borderRadius:20,
                                      textTransform:"uppercase", letterSpacing:"0.6px" }}>
                                      ü™î Satsang
                                    </span>
                                  </div>
                                  <div style={{ fontSize:13, color:"#d97706",
                                    fontWeight:700, marginBottom:3 }}>
                                    ‚è∞ {cleanTime(b.time)} onwards
                                  </div>
                                  {b.venue && (
                                    <div style={{ fontSize:12, color:"#6b7280" }}>
                                      {b.mapsLink
                                        ? <a href={b.mapsLink} target="_blank" rel="noopener noreferrer"
                                            style={{ color:"#d97706", fontWeight:600, textDecoration:"none" }}>
                                            üìç {b.venue} ¬∑ Map</a>
                                        : <>üìç {b.venue}</>}
                                    </div>
                                  )}
                                  {b.hostedBy && (
                                    <div style={{ fontSize:12, color:"#92400e",
                                      fontWeight:600, marginTop:3 }}>
                                      üôè {b.hostedBy}
                                    </div>
                                  )}
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          );
        };

        return <AllBookingsView />;
      })()}

      {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SATSANG TAB ‚Äî 3-MODE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
      {activeTab === "manage" && manageTab === "announce" && (
        <div style={{ display:"flex", flexDirection:"column", gap:16 }}>

          {/* Header */}
          <div className="card" style={{ padding:"20px 16px 16px", textAlign:"center" }}>
            <div style={{ fontSize:38, marginBottom:8,
              filter:"drop-shadow(0 0 12px rgba(29,78,216,0.3))",
              animation:"floatEmoji 3s ease-in-out infinite alternate" }}>üì®</div>
            <div style={{ fontFamily:"'Cinzel',serif", color:"#1e3a8a",
              fontSize:17, fontWeight:800, marginBottom:4 }}>Create a Message</div>
            <div style={{ fontSize:12, color:"rgba(29,78,216,0.45)", lineHeight:1.7 }}>
              Craft a Satsang invitation or a custom message to share
            </div>
            <div className="blue-line" style={{ marginTop:14 }}/>
          </div>

          {/* Message type selector */}
          <div className="card">
            <label className="divine-label">Select Message Type</label>
            <select className="divine-input" value={msgType}
              onChange={e => {
                setMsgType(e.target.value);
                setSatsang({ date:"", time:"", venue:"", mapsLink:"", hostedBy:"" });
                setCustomMsg({ body:"", author:"" });
              }}
              style={{ cursor:"pointer", fontSize:14, fontWeight:700 }}>
              <option value="">‚Äî Choose a type ‚Äî</option>
              <option value="satsang">ü™î Satsang Invitation</option>
              <option value="custom">‚úçÔ∏è Custom Message</option>
            </select>
          </div>

          {/* ‚îÄ‚îÄ SATSANG INVITATION ‚îÄ‚îÄ */}
          {msgType === "satsang" && (() => {
            const builtMsg = satsang.date||satsang.venue ? buildSatsangMsg() : "";
            return (
              <div className="card">
                <div style={{ fontFamily:"'Cinzel',serif", color:"#1e3a8a",
                  fontSize:15, fontWeight:700, marginBottom:14 }}>
                  üìú Satsang Invitation
                </div>
                <div style={{ display:"flex", flexDirection:"column", gap:13 }}>
                  <div><label className="divine-label">üìÖ Date</label>
                    <input type="date" className="divine-input" value={satsang.date}
                      style={{ fontSize:13, width:"100%", cursor:"pointer" }}
                      onChange={e=>setSatsang({...satsang,date:e.target.value})}/></div>
                  <div><label className="divine-label">‚è∞ Time</label>
                    <input className="divine-input" placeholder="e.g. 4:30 PM"
                      value={satsang.time} onChange={e=>setSatsang({...satsang,time:e.target.value})}/></div>
                  <div><label className="divine-label">üìç Venue / Address</label>
                    <input className="divine-input" placeholder="e.g. 47, Bannerghatta SUK, Bangalore"
                      value={satsang.venue} onChange={e=>setSatsang({...satsang,venue:e.target.value})}/></div>
                  <div><label className="divine-label">üìå Google Maps Link (optional)</label>
                    <input className="divine-input" placeholder="Paste Google Maps link"
                      value={satsang.mapsLink} onChange={e=>setSatsang({...satsang,mapsLink:e.target.value})}/></div>
                  <div><label className="divine-label">üôè Hosted By</label>
                    <input className="divine-input" placeholder="e.g. Bannerghatta SUK"
                      value={satsang.hostedBy} onChange={e=>setSatsang({...satsang,hostedBy:e.target.value})}/></div>

                  {builtMsg ? (
                    <>
                      <label className="divine-label">Message Preview</label>
                      <div style={{ padding:"14px", borderRadius:12, fontSize:13, lineHeight:1.85,
                        background:"rgba(255,251,235,0.8)", border:"1px solid rgba(217,119,6,0.2)",
                        whiteSpace:"pre-wrap", color:"#1f2937", fontFamily:"'Lato',sans-serif" }}>
                        {builtMsg}
                      </div>
                      <a onClick={()=>shareWhatsApp(builtMsg)}
                        style={{ display:"flex", alignItems:"center", justifyContent:"center", gap:8,
                          padding:"13px", borderRadius:12, textDecoration:"none", cursor:"pointer",
                          background:"linear-gradient(135deg,#25D366,#128C7E)", color:"#fff",
                          fontWeight:800, fontSize:14, boxShadow:"0 4px 14px rgba(37,211,102,0.3)" }}>
                        üí¨ Share on WhatsApp
                      </a>
                      <div style={{ display:"flex", gap:8 }}>
                        <a onClick={()=>shareSMS(builtMsg)}
                          style={{ flex:1, display:"flex", alignItems:"center", justifyContent:"center",
                            gap:6, padding:"11px", borderRadius:12, textDecoration:"none", cursor:"pointer",
                            background:"linear-gradient(135deg,#1d4ed8,#3b82f6)", color:"#fff",
                            fontWeight:700, fontSize:13 }}>üì± SMS</a>
                        <button onClick={()=>shareCopy(builtMsg)}
                          style={{ flex:1, display:"flex", alignItems:"center", justifyContent:"center",
                            gap:6, padding:"11px", borderRadius:12, border:"none", cursor:"pointer",
                            background:"rgba(30,64,175,0.08)", color:"#1e3a8a",
                            fontWeight:700, fontSize:13 }}>üìã Copy</button>
                      </div>
                    </>
                  ) : (
                    <div style={{ textAlign:"center", padding:"14px 0",
                      color:"rgba(29,78,216,0.35)", fontSize:13 }}>
                      Fill in the details above to preview the message üôè
                    </div>
                  )}
                </div>
              </div>
            );
          })()}

          {/* ‚îÄ‚îÄ CUSTOM MESSAGE ‚îÄ‚îÄ */}
          {msgType === "custom" && (() => {
            const builtMsg = customMsg.body.trim() ? buildCustomMsg() : "";
            return (
              <div className="card">
                <div style={{ fontFamily:"'Cinzel',serif", color:"#1e3a8a",
                  fontSize:15, fontWeight:700, marginBottom:14 }}>
                  ‚úçÔ∏è Custom Message
                </div>
                <div style={{ display:"flex", flexDirection:"column", gap:13 }}>
                  <div><label className="divine-label">Your Message</label>
                    <textarea className="divine-input" placeholder="Type your message here... üôè"
                      rows={6} value={customMsg.body}
                      onChange={e=>setCustomMsg({...customMsg,body:e.target.value})}
                      style={{ resize:"vertical", fontFamily:"'Lato',sans-serif", lineHeight:1.7 }}/></div>
                  <div><label className="divine-label">Your Name (optional)</label>
                    <input className="divine-input" placeholder="e.g. Bannerghatta SUK"
                      value={customMsg.author} onChange={e=>setCustomMsg({...customMsg,author:e.target.value})}/></div>

                  {builtMsg ? (
                    <>
                      <label className="divine-label">Message Preview</label>
                      <div style={{ padding:"14px", borderRadius:12, fontSize:13, lineHeight:1.85,
                        background:"rgba(20,40,120,0.04)", border:"1px solid rgba(59,130,246,0.15)",
                        whiteSpace:"pre-wrap", color:"#1f2937", fontFamily:"'Lato',sans-serif" }}>
                        {builtMsg}
                      </div>
                      <a onClick={()=>shareWhatsApp(builtMsg)}
                        style={{ display:"flex", alignItems:"center", justifyContent:"center", gap:8,
                          padding:"13px", borderRadius:12, textDecoration:"none", cursor:"pointer",
                          background:"linear-gradient(135deg,#25D366,#128C7E)", color:"#fff",
                          fontWeight:800, fontSize:14, boxShadow:"0 4px 14px rgba(37,211,102,0.3)" }}>
                        üí¨ Share on WhatsApp
                      </a>
                      <div style={{ display:"flex", gap:8 }}>
                        <a onClick={()=>shareSMS(builtMsg)}
                          style={{ flex:1, display:"flex", alignItems:"center", justifyContent:"center",
                            gap:6, padding:"11px", borderRadius:12, textDecoration:"none", cursor:"pointer",
                            background:"linear-gradient(135deg,#1d4ed8,#3b82f6)", color:"#fff",
                            fontWeight:700, fontSize:13 }}>üì± SMS</a>
                        <button onClick={()=>shareCopy(builtMsg)}
                          style={{ flex:1, display:"flex", alignItems:"center", justifyContent:"center",
                            gap:6, padding:"11px", borderRadius:12, border:"none", cursor:"pointer",
                            background:"rgba(30,64,175,0.08)", color:"#1e3a8a",
                            fontWeight:700, fontSize:13 }}>üìã Copy</button>
                      </div>
                    </>
                  ) : null}
                </div>
              </div>
            );
          })()}

        </div>
      )}


      {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PRAYER GALLERY TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
      {activeTab === "manage" && manageTab === "gallery" && (
        <div style={{ display:"flex", flexDirection:"column", gap:16 }}>

          {/* Header */}
          <div className="card" style={{ textAlign:"center", padding:"22px 16px 18px" }}>
            <div style={{ fontSize:44, marginBottom:8,
              filter:"drop-shadow(0 0 18px rgba(255,160,200,0.5))",
              animation:"floatEmoji 3s ease-in-out infinite alternate" }}>üå∏</div>
            <div style={{ fontFamily:"'Cinzel',serif", color:"#1e3a8a", fontSize:18, fontWeight:800, marginBottom:4 }}>
              Prayer Photo Gallery
            </div>
            <div style={{ fontSize:12, color:"rgba(29,78,216,0.45)", lineHeight:1.7 }}>
              Upload & cherish sacred prayer moments
            </div>
            <div className="blue-line" style={{ marginTop:14 }}/>
          </div>

          {/* Upload form */}
          <div className="card">
            <div style={{ fontFamily:"'Cinzel',serif", color:"#1e3a8a", fontSize:14,
              fontWeight:700, marginBottom:14 }}>üì∏ Upload a Photo</div>
            <div style={{ display:"flex", flexDirection:"column", gap:13 }}>

              {/* Photo picker */}
              <div>
                <label className="divine-label">Select Photo</label>
                <label style={{ display:"flex", flexDirection:"column", alignItems:"center",
                  justifyContent:"center", gap:8, padding:"20px 16px", borderRadius:14,
                  border:"2px dashed rgba(59,130,246,0.3)",
                  background:"rgba(239,246,255,0.5)", cursor:"pointer", textAlign:"center" }}>
                  {photoUpload.preview ? (
                    <img src={photoUpload.preview} alt="preview"
                      style={{ maxWidth:"100%", maxHeight:200, borderRadius:10,
                        objectFit:"cover", boxShadow:"0 4px 12px rgba(0,0,0,0.1)" }}/>
                  ) : (
                    <>
                      <span style={{ fontSize:36 }}>üå∏</span>
                      <span style={{ fontSize:13, color:"rgba(29,78,216,0.5)", fontWeight:600 }}>
                        Tap to choose a photo
                      </span>
                      <span style={{ fontSize:11, color:"rgba(29,78,216,0.35)" }}>
                        JPG, PNG up to 5MB
                      </span>
                    </>
                  )}
                  <input type="file" accept="image/*"
                    style={{ position:"absolute", opacity:0, width:0, height:0 }}
                    onChange={e => {
                      const file = e.target.files[0];
                      if (!file) return;
                      if (file.size > 5 * 1024 * 1024) { setPhotoMsg("‚ö†Ô∏è Photo must be under 5MB."); return; }
                      setPhotoMsg("");
                      const reader = new FileReader();
                      reader.onload = ev => setPhotoUpload(p => ({...p, file, preview:ev.target.result}));
                      reader.readAsDataURL(file);
                    }}/>
                </label>
              </div>

              <div><label className="divine-label">Caption (optional)</label>
                <input className="divine-input" placeholder="e.g. Morning prayer at home, Feb 2026"
                  value={photoUpload.caption}
                  onChange={e=>setPhotoUpload(p=>({...p,caption:e.target.value}))}/></div>

              <div><label className="divine-label">Your Name (optional)</label>
                <input className="divine-input" placeholder="e.g. Bannerghatta SUK"
                  value={photoUpload.uploader}
                  onChange={e=>setPhotoUpload(p=>({...p,uploader:e.target.value}))}/></div>

              {photoMsg && (
                <div style={{ padding:"10px 14px", borderRadius:10, fontSize:13, fontWeight:600,
                  background: photoMsg.startsWith("‚úÖ") ? "#d1fae5" : "#fef3c7",
                  color: photoMsg.startsWith("‚úÖ") ? "#065f46" : "#92400e" }}>
                  {photoMsg}
                </div>
              )}

              <button onClick={handlePhotoUpload} disabled={photoUploading || !photoUpload.file}
                className="submit-btn">
                {photoUploading ? "‚è≥ Uploading..." : "üå∏ Upload Photo"}
              </button>

              {!isConfigured && (
                <div style={{ fontSize:11, color:"rgba(217,119,6,0.7)", textAlign:"center" }}>
                  ‚öôÔ∏è Configure Script URL to enable uploads
                </div>
              )}
            </div>
          </div>

          {/* Photo grid */}
          <div className="card">
            <div style={{ fontFamily:"'Cinzel',serif", color:"#1e3a8a", fontSize:14,
              fontWeight:700, marginBottom:14 }}>
              üå∏ Prayer Photo Gallery
              {photos.length > 0 && (
                <span style={{ fontSize:11, color:"rgba(29,78,216,0.45)", fontWeight:600,
                  marginLeft:8 }}>({photos.length} photos)</span>
              )}
            </div>
            {photosLoading ? (
              <div style={{ textAlign:"center", padding:"24px", color:"rgba(29,78,216,0.4)", fontSize:13 }}>
                ‚è≥ Loading gallery...
              </div>
            ) : photos.length === 0 ? (
              <div style={{ textAlign:"center", padding:"30px 0" }}>
                <div style={{ fontSize:40, marginBottom:10,
                  filter:"saturate(0) brightness(2.2)" }}>ü™∑</div>
                <div style={{ color:"rgba(29,78,216,0.35)", fontSize:13 }}>
                  No photos yet ‚Äî be the first to share a sacred moment üôè
                </div>
              </div>
            ) : (
              <div style={{ display:"grid", gridTemplateColumns:"repeat(2,1fr)", gap:10 }}>
                {photos.map((p,i) => (
                  <div key={i} style={{ borderRadius:12, overflow:"hidden",
                    border:"1px solid rgba(59,130,246,0.15)",
                    background:"rgba(239,246,255,0.4)" }}>
                    <img src={p.url} alt={p.caption||"Prayer"} loading="lazy"
                      style={{ width:"100%", aspectRatio:"1/1", objectFit:"cover",
                        display:"block" }}/>
                    {(p.caption || p.uploader) && (
                      <div style={{ padding:"8px 10px" }}>
                        {p.caption && (
                          <div style={{ fontSize:11, color:"#1e3a8a", fontWeight:600,
                            lineHeight:1.4, marginBottom:2 }}>{p.caption}</div>
                        )}
                        {p.uploader && (
                          <div style={{ fontSize:10, color:"rgba(29,78,216,0.45)" }}>
                            üôè {p.uploader}
                          </div>
                        )}
                        {p.date && (
                          <div style={{ fontSize:10, color:"rgba(29,78,216,0.3)", marginTop:2 }}>
                            {p.date}
                          </div>
                        )}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      )}



      {/* Footer */}
      <div style={{ textAlign:"center", marginTop:36, paddingBottom:10 }}>
        <div style={{ ...mutedBlue, fontSize:11, letterSpacing:2 }}>‚ú¶ ‚ú¶ ‚ú¶</div>
        <div style={{ fontFamily:"'Cinzel', serif", color:"rgba(30,64,175,0.35)", fontSize:12, marginTop:6 }}>
          {ACTIVE_SUK ? sukLabel(ACTIVE_SUK)+(ACTIVE_SUK.location ? " ¬∑ "+ACTIVE_SUK.location : "") : "Satsang Upayojana Kendra"}
        </div>
      </div>

    </div>
  );
}


// ============================================================
//  WELCOME SCREEN ‚Äî DROPDOWN SUK SELECTOR
// ============================================================
function WelcomeScreen({ onSelect }) {
  const suks = Object.values(SUK_CONFIG);
  const [selected, setSelected] = React.useState("");
  const [launching, setLaunching] = React.useState(false);

  const activeSuk  = selected ? SUK_CONFIG[selected] : null;
  const canLaunch  = activeSuk && activeSuk.configured;

  const handleLaunch = () => {
    if (!canLaunch) return;
    setLaunching(true);
    setTimeout(() => onSelect(activeSuk), 520);
  };

  // Feature badge list for preview
  return (
    <div style={{
      minHeight:"100vh", display:"flex", flexDirection:"column",
      alignItems:"center", justifyContent:"center",
      padding:"32px 16px", position:"relative", zIndex:10,
    }}>

      {/* Lotus */}
      <span style={{ fontSize:36, display:"inline-block", marginBottom:10,
        filter:"drop-shadow(0 0 18px rgba(255,180,0,0.6))",
        animation:"floatEmoji 3s ease-in-out infinite alternate" }}>ü™∑</span>

      {/* JAYGURU title */}
      <div style={{ fontFamily:"'Cinzel',serif", fontWeight:900,
        fontSize:"clamp(30px,8vw,50px)", letterSpacing:"8px", textAlign:"center",
        background:"linear-gradient(135deg,#1e3a8a 0%,#2563eb 50%,#d97706 100%)",
        WebkitBackgroundClip:"text", WebkitTextFillColor:"transparent", backgroundClip:"text" }}>
        JAYGURU
      </div>
      <div style={{ fontFamily:"'Cinzel',serif", fontSize:11, fontWeight:700,
        letterSpacing:"5px", color:"rgba(29,78,216,0.45)",
        textTransform:"uppercase", marginTop:4, textAlign:"center" }}>
        üôè Satsang Upayojana Kendra üôè
      </div>

      {/* Ornamental divider */}
      <div style={{ display:"flex", alignItems:"center", gap:10,
        margin:"18px 0 24px", width:"100%", maxWidth:400 }}>
        <div style={{ flex:1, height:1,
          background:"linear-gradient(90deg,transparent,rgba(255,200,60,0.45),rgba(59,130,246,0.3))" }}/>
        <span style={{ fontSize:14, color:"rgba(255,180,0,0.7)" }}>‚ú¶</span>
        <div style={{ flex:1, height:1,
          background:"linear-gradient(90deg,rgba(59,130,246,0.3),rgba(255,200,60,0.45),transparent)" }}/>
      </div>

      {/* ‚îÄ‚îÄ DROPDOWN CARD ‚îÄ‚îÄ */}
      <div style={{ width:"100%", maxWidth:400,
        background:"rgba(255,255,255,0.82)", borderRadius:22,
        padding:"28px 24px 24px",
        boxShadow:"0 8px 40px rgba(29,78,216,0.13), 0 2px 8px rgba(0,0,0,0.05)",
        border:"1.5px solid rgba(59,130,246,0.14)",
        backdropFilter:"blur(14px)",
        animation:"fadeSlideIn 0.5s ease-out both" }}>

        {/* Label */}
        <div style={{ fontFamily:"'Cinzel',serif", fontSize:12, fontWeight:800,
          color:"rgba(29,78,216,0.55)", letterSpacing:"2.5px",
          textTransform:"uppercase", marginBottom:10 }}>
          Select Your Satsang Upayojana Kendra
        </div>

        {/* Dropdown */}
        <div style={{ position:"relative" }}>
          <select
            value={selected}
            onChange={e => setSelected(e.target.value)}
            style={{
              width:"100%", padding:"14px 44px 14px 16px",
              borderRadius:13, fontSize:14, fontWeight:700,
              fontFamily:"'Cinzel',serif",
              color: selected ? "#1e3a8a" : "rgba(29,78,216,0.4)",
              background:"rgba(239,246,255,0.7)",
              border:"1.5px solid rgba(59,130,246,0.22)",
              outline:"none", cursor:"pointer",
              appearance:"none", WebkitAppearance:"none",
              boxShadow:"0 2px 8px rgba(29,78,216,0.07)",
              transition:"border-color 0.2s",
            }}>
            <option value="" disabled>‚Äî Choose a Kendra ‚Äî</option>
            {suks.map(suk => (
              <option key={suk.key} value={suk.key}
                disabled={!suk.configured}>
                {`ü™∑  ${sukLabel(suk)}${suk.location ? " ¬∑ "+suk.location : ""}${!suk.configured ? "  (Coming Soon)" : ""}`}
              </option>
            ))}
          </select>
          {/* Custom dropdown arrow */}
          <div style={{ position:"absolute", right:14, top:"50%",
            transform:"translateY(-50%)", pointerEvents:"none",
            color:"rgba(29,78,216,0.5)", fontSize:12 }}>‚ñº</div>
        </div>

        {/* Feature preview ‚Äî shown after selection */}
        {activeSuk && (
          <div style={{ marginTop:16, padding:"14px 16px", borderRadius:14,
            background:`linear-gradient(135deg,${activeSuk.themeColor}0a,${activeSuk.themeColor}05)`,
            border:`1px solid ${activeSuk.themeColor}20`,
            animation:"fadeSlideIn 0.3s ease-out both" }}>

            {/* SUK header */}
            <div style={{ display:"flex", alignItems:"center", gap:10, marginBottom:12 }}>
              <div style={{ fontSize:24,
                filter:`drop-shadow(0 0 8px ${activeSuk.themeColor}60)` }}>
                {activeSuk.emoji}
              </div>
              <div>
                <div style={{ fontFamily:"'Cinzel',serif", fontWeight:800,
                  fontSize:14, color:"#1e3a8a" }}>{sukLabel(activeSuk)}</div>
                <div style={{ fontSize:11, color:"rgba(29,78,216,0.45)",
                  fontWeight:600 }}>{activeSuk.location ? `üìç ${activeSuk.location}` : ""}</div>
              </div>

            </div>

          </div>
        )}

        {/* Launch button */}
        <button
          onClick={handleLaunch}
          disabled={!canLaunch || launching}
          style={{
            width:"100%", marginTop:18,
            padding:"15px", borderRadius:13, border:"none",
            fontFamily:"'Cinzel',serif", fontWeight:800,
            fontSize:15, letterSpacing:"1px",
            cursor: canLaunch ? "pointer" : "not-allowed",
            transition:"all 0.25s cubic-bezier(0.34,1.56,0.64,1)",
            transform: (canLaunch && !launching) ? "scale(1)" : "scale(0.98)",
            background: canLaunch
              ? launching
                ? `linear-gradient(135deg,${activeSuk.themeColor},${activeSuk.themeColor}cc)`
                : `linear-gradient(135deg,#0f2266,#1d4ed8,#3b82f6)`
              : "rgba(200,210,230,0.5)",
            color: canLaunch ? "#fff" : "#aaa",
            boxShadow: canLaunch ? "0 6px 24px rgba(29,78,216,0.3)" : "none",
          }}>
          {launching
            ? `${activeSuk.emoji}  Entering ${sukLabel(activeSuk)}...`
            : canLaunch
              ? `${activeSuk.emoji}  Open ${sukLabel(activeSuk)}`
              : "Select a Kendra to continue"}
        </button>

      </div>

      {/* Bottom tagline */}
      <div style={{ marginTop:24, textAlign:"center" }}>
        <div style={{ fontSize:10, color:"rgba(29,78,216,0.28)", fontWeight:600,
          letterSpacing:"2px", textTransform:"uppercase" }}>
          Book ¬∑ Satsang ¬∑ Photos ¬∑ Manage
        </div>
        <div style={{ fontSize:11, color:"rgba(29,78,216,0.2)", marginTop:5,
          fontFamily:"'Cinzel',serif" }}>
          Jayguru üôè
        </div>
      </div>

    </div>
  );
}


// ============================================================
//  APP SHELL ‚Äî manages SUK selection + renders App
// ============================================================
function AppShell() {
  const [selectedSuk, setSelectedSuk] = React.useState(() => {
    try {
      const saved = sessionStorage.getItem("activeSuk");
      if (saved) {
        const suk = SUK_CONFIG[saved];
        if (suk && suk.configured) {
          SCRIPT_URL = suk.scriptUrl;
          API_KEY    = suk.apiKey;
          ACTIVE_SUK = suk;
          return suk;
        }
      }
    } catch(e) {}
    return null;
  });

  // appKey forces full App remount when SUK changes ‚Äî clears all state & reloads data
  const [appKey, setAppKey] = React.useState(0);

  // Called from WelcomeScreen ‚Äî load selected SUK
  const handleSelectSuk = (suk) => {
    SCRIPT_URL = suk.scriptUrl;
    API_KEY    = suk.apiKey;
    ACTIVE_SUK = suk;
    try { sessionStorage.setItem("activeSuk", suk.key); } catch(e) {}
    setSelectedSuk(suk);
    setAppKey(k => k + 1); // remount App with fresh state
  };

  // Called from App header dropdown ‚Äî switch to different SUK without going back to welcome
  // action="switch" means stay in app but reload for new SUK
  // action=undefined means go back to welcome screen
  const handleChangeSuk = (action, suk) => {
    if (action === "switch" && suk) {
      SCRIPT_URL = suk.scriptUrl;
      API_KEY    = suk.apiKey;
      ACTIVE_SUK = suk;
      try { sessionStorage.setItem("activeSuk", suk.key); } catch(e) {}
      setSelectedSuk(suk);
      setAppKey(k => k + 1); // remount App ‚Üí all data refreshes for new SUK
    } else {
      // Go back to welcome screen
      SCRIPT_URL = "";
      API_KEY    = "";
      ACTIVE_SUK = null;
      try { sessionStorage.removeItem("activeSuk"); } catch(e) {}
      setSelectedSuk(null);
    }
  };

  if (!selectedSuk) {
    return <WelcomeScreen onSelect={handleSelectSuk} />;
  }

  // key={appKey} forces full remount when SUK changes ‚Äî all bookings/state resets & reloads
  return <App key={appKey} onChangeSuk={handleChangeSuk} />;
}

ReactDOM.createRoot(document.getElementById("root")).render(<AppShell />);
</script>

<script>
(function() {
  var BASE    = (typeof APP_CONFIG !== 'undefined' ? APP_CONFIG.basePath : '/bsuk/');
  var IS_IOS  = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
  var IS_SA   = window.matchMedia('(display-mode: standalone)').matches
                || window.navigator.standalone === true;
  var SKIP    = 'suk_skip';
  var prompt_ = null;

  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register(BASE + 'sw.js', { scope: BASE })
        .then(function(reg) {
          reg.addEventListener('updatefound', function() {
            var nw = reg.installing;
            nw.addEventListener('statechange', function() {
              if (nw.state === 'installed' && navigator.serviceWorker.controller)
                showUpdateToast();
            });
          });
        }).catch(function(e){ console.log('SW error', e); });
    });
  }

  window.addEventListener('beforeinstallprompt', function(e) {
    e.preventDefault();
    prompt_ = e;
    if (!IS_SA && !sessionStorage.getItem(SKIP))
      setTimeout(showAndroidBanner, 2500);
  });
  window.addEventListener('appinstalled', function() { remove_('suk-pwa'); });

  window.addEventListener('load', function() {
    if (!IS_IOS || IS_SA || sessionStorage.getItem(SKIP)) return;
    setTimeout(showIOSSheet, 2500);
  });

  function remove_(id) { var el = document.getElementById(id); if (el) el.remove(); }
  function css(el, s)  { el.style.cssText = s; return el; }
  function mkBtn(text, s, fn) {
    var b = css(document.createElement('button'), s);
    b.textContent = text;
    b.addEventListener('click', fn);
    return b;
  }
  function addAnim(name, kf) {
    var s = document.createElement('style');
    s.textContent = '@keyframes ' + name + '{' + kf + '}';
    document.head.appendChild(s);
  }

  function showAndroidBanner() {
    if (document.getElementById('suk-pwa')) return;
    addAnim('sukSlide','from{transform:translateY(90px);opacity:0}to{transform:translateY(0);opacity:1}');
    var wrap = css(document.createElement('div'),
      'position:fixed;bottom:70px;left:12px;right:12px;z-index:99999;'+
      'background:linear-gradient(135deg,#0e2266,#1d4ed8);color:#fff;'+
      'padding:14px 16px;border-radius:18px;'+
      'box-shadow:0 8px 32px rgba(14,34,102,0.5);'+
      'display:flex;align-items:center;gap:12px;font-family:sans-serif;'+
      'animation:sukSlide 0.35s ease;');
    wrap.id = 'suk-pwa';
    var icon = css(document.createElement('img'),
      'width:44px;height:44px;border-radius:10px;flex-shrink:0;');
    icon.src = BASE + 'icons/icon-96.png';
    var txt = css(document.createElement('div'),'flex:1;min-width:0;');
    var t1  = css(document.createElement('div'),'font-size:14px;font-weight:800;margin-bottom:3px;');
    t1.textContent = 'Install SUK Bangalore';
    var t2  = css(document.createElement('div'),'font-size:11px;opacity:0.75;line-height:1.4;');
    t2.textContent = 'Add to home screen ‚Äî opens like a native app';
    txt.appendChild(t1); txt.appendChild(t2);
    var btns = css(document.createElement('div'),
      'display:flex;flex-direction:column;gap:7px;flex-shrink:0;');
    btns.appendChild(mkBtn('Install',
      'background:#fff;border:none;color:#1d4ed8;padding:8px 18px;'+
      'border-radius:20px;cursor:pointer;font-size:12px;font-weight:900;',
      function() {
        if (prompt_) { prompt_.prompt(); prompt_.userChoice.then(function(){ prompt_=null; }); }
        remove_('suk-pwa');
      }
    ));
    btns.appendChild(mkBtn('Not now',
      'background:none;border:none;color:rgba(255,255,255,0.55);font-size:11px;cursor:pointer;',
      function() { sessionStorage.setItem(SKIP,'1'); remove_('suk-pwa'); }
    ));
    wrap.appendChild(icon); wrap.appendChild(txt); wrap.appendChild(btns);
    document.body.appendChild(wrap);
  }

  function showIOSSheet() {
    if (document.getElementById('suk-pwa')) return;
    addAnim('sukUp','from{transform:translateY(100%)}to{transform:translateY(0)}');

    var bd = css(document.createElement('div'),
      'position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:99998;');
    function dismiss() {
      sessionStorage.setItem(SKIP,'1');
      bd.remove(); remove_('suk-pwa');
    }
    bd.addEventListener('click', dismiss);

    var sheet = css(document.createElement('div'),
      'position:fixed;bottom:0;left:0;right:0;z-index:99999;'+
      'background:#fff;border-radius:22px 22px 0 0;'+
      'box-shadow:0 -6px 40px rgba(0,0,0,0.15);font-family:sans-serif;'+
      'padding-bottom:36px;animation:sukUp 0.3s ease;');
    sheet.id = 'suk-pwa';

    sheet.appendChild(css(document.createElement('div'),
      'width:38px;height:4px;background:rgba(0,0,0,0.14);'+
      'border-radius:2px;margin:12px auto 16px;'));

    var hdr = css(document.createElement('div'),
      'display:flex;align-items:center;gap:12px;padding:0 20px 14px;');
    var hImg = css(document.createElement('img'),
      'width:52px;height:52px;border-radius:14px;flex-shrink:0;'+
      'box-shadow:0 2px 10px rgba(29,78,216,0.25);');
    hImg.src = BASE + 'icons/icon-96.png';
    var hTxt = document.createElement('div');
    var hN = css(document.createElement('div'),
      'font-size:16px;font-weight:800;color:#1e3a8a;');
    hN.textContent = 'SUK Bangalore';
    var hS = css(document.createElement('div'),
      'font-size:11px;color:#9ca3af;margin-top:2px;');
    hS.textContent = 'Install as App ‚Äî Free';
    hTxt.appendChild(hN); hTxt.appendChild(hS);
    hdr.appendChild(hImg); hdr.appendChild(hTxt);
    hdr.appendChild(mkBtn('‚úï',
      'margin-left:auto;background:rgba(0,0,0,0.07);border:none;'+
      'width:30px;height:30px;border-radius:50%;cursor:pointer;'+
      'font-size:15px;color:#6b7280;flex-shrink:0;',
      dismiss
    ));
    sheet.appendChild(hdr);

    sheet.appendChild(css(document.createElement('div'),
      'height:1px;background:rgba(0,0,0,0.07);margin:0 20px 16px;'));

    var steps = css(document.createElement('div'),
      'padding:0 20px;display:flex;flex-direction:column;gap:16px;');
    [
      ['1', 'Tap the Share ‚Üë button at the bottom of Safari'],
      ['2', 'Scroll down and tap + "Add to Home Screen"'],
      ['‚úì', 'App saves to your home screen. Opens fullscreen!']
    ].forEach(function(row) {
      var r = css(document.createElement('div'),
        'display:flex;align-items:flex-start;gap:12px;');
      var badge = css(document.createElement('div'),
        'width:28px;height:28px;border-radius:50%;flex-shrink:0;'+
        'background:linear-gradient(135deg,#1d4ed8,#3b82f6);'+
        'display:flex;align-items:center;justify-content:center;'+
        'font-size:13px;font-weight:900;color:#fff;margin-top:2px;');
      badge.textContent = row[0];
      var desc = css(document.createElement('div'),
        'font-size:13px;color:#374151;line-height:1.6;');
      desc.textContent = row[1];
      r.appendChild(badge); r.appendChild(desc);
      steps.appendChild(r);
    });
    sheet.appendChild(steps);

    var hint = css(document.createElement('div'),
      'margin:18px 20px 0;background:rgba(29,78,216,0.07);'+
      'border-radius:12px;padding:10px 14px;text-align:center;');
    var hintSpan = css(document.createElement('span'),
      'font-size:12px;font-weight:700;color:#1d4ed8;');
    hintSpan.textContent = 'Look for the Share button at the bottom of Safari';
    hint.appendChild(hintSpan);
    sheet.appendChild(hint);

    document.body.appendChild(bd);
    document.body.appendChild(sheet);
  }

  function showUpdateToast() {
    var t = css(document.createElement('div'),
      'position:fixed;top:16px;left:50%;transform:translateX(-50%);z-index:99999;'+
      'background:#1d4ed8;color:#fff;padding:10px 18px;border-radius:30px;'+
      'box-shadow:0 4px 20px rgba(0,0,0,0.25);display:flex;align-items:center;'+
      'gap:10px;font-family:sans-serif;font-size:13px;font-weight:600;white-space:nowrap;');
    var msg = document.createElement('span');
    msg.textContent = 'New version available';
    t.appendChild(msg);
    t.appendChild(mkBtn('Update',
      'background:rgba(255,255,255,0.25);border:none;color:#fff;'+
      'padding:5px 14px;border-radius:20px;cursor:pointer;font-size:12px;font-weight:700;',
      function(){ window.location.reload(); }
    ));
    document.body.appendChild(t);
    setTimeout(function(){ t.remove(); }, 12000);
  }

})();
</script>
</body>
</html>